<!DOCTYPE html><html lang="en"><head>
    <meta charset="utf-8">
<title>Build automation, packaging, and release</title>
<meta name="description" content="Introduction to agile and DevOps, a case from the literature, SCRUM">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><link rel="stylesheet" href="/course-slides/reveal-js/dist/reset.css">
<link rel="stylesheet" href="/course-slides/reveal-js/dist/reveal.css">
  <link rel="stylesheet" href="/course-slides/css/custom-theme.min.3bee906a09133576f8ef092100894160e8353673dfec5c3b5e6c6a2c025152eb.css" id="theme"><link rel="stylesheet" href="/course-slides/highlight-js/github.min.css">
<link rel="stylesheet" href="https://raw.githubusercontent.com/DanySK/css-blur-animation/master/blur.css">
<link href="https://fonts.googleapis.com/css?family=Roboto Mono" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Oxygen Mono" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Ubuntu Mono" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
<script src="https://kit.fontawesome.com/81ac037be0.js" crossorigin="anonymous"></script>
<script src="https://unibo-dtm-se.github.io/course-slides//plantuml.js"></script>

  </head>
  <body>
    
    <div class="reveal">
      <div class="slides">
  

    <section><h1 id="build-automation-packaging-and-release">Build automation, packaging, and release</h1>
<br>
<h2 style="margin-bottom: 0;">Software Engineering</h2>
<h3 id="for-intelligent-distributed-systems"><strong>(for Intelligent Distributed Systems)</strong></h3>
<h4 id="hahahugoshortcode1s1hbhb">A.Y. 2024/2025</h4>
<h5 id="hahahugoshortcode1s2hbhb-reusing-material-made-by-hahahugoshortcode1s3hbhb"><a href="mailto:giovanni.ciatto@unibo.it">Giovanni Ciatto</a> (reusing material made by <a href="mailto:danilo.pianini@unibo.it">Danilo Pianini</a>)</h5>
<br>
<br>
<p>Compiled on: 2025-02-18 — <a href="?print-pdf&amp;pdfSeparateFragments=false"><i class="fa fa-print" aria-hidden="true"></i> printable version</a></p>
<p><a href="../#/toc"><i class="fa fa-undo" aria-hidden="true"></i> back</a></p>
</section><section>
<h1 id="the-build-life-cycle">The build “life cycle”</h1>
<p>(Not to be confused with the system development life cycle (SDLC))</p>
<blockquote>
<p>The process of creating <em>tested deployable software artifacts</em>
<br>
from <em>source</em> code</p></blockquote>
<p>May include, depending on the system specifics:</p>
<ol>
<li><em>Source code manipulation</em> and generation</li>
<li>Source code <em>quality assurance</em></li>
<li><strong>Dependency management</strong></li>
<li><em>Compilation</em>, linking</li>
<li><em>Binary manipulation</em></li>
<li><em>Test execution</em></li>
<li>Test <em>quality assurance</em> (e.g., coverage)</li>
<li>API <em>documentation</em></li>
<li><strong>Packaging</strong></li>
<li><strong>Delivery</strong></li>
</ol>
<!-- ---

# Lifecycle styles

* **Custom**: select some phases that the product needs and perform them.
    * *Flexible and configurable*: tailored on each project's needs
    * *Hard to adapt and port*

* **Standard**: run a sequence of pre-defined actions/phases.
    * *Portable and easy to understand*: replicated on every product
    * *Limited configuration options* -->
</section><section>
<h1 id="build-automation">Build automation</h1>
<p>Automation of the build lifecycle</p>
<ul>
<li>In principle, the lifecycle could be executed manually</li>
<li>In reality <em>time is precious</em> and <em>repetitivy is boring</em> (and <strong>error-prone</strong>)</li>
</ul>
<blockquote>
<p>$\Rightarrow$ Create software that automates the building of some software!</p></blockquote>
<ul>
<li>All those concerns that hold for software creation hold for build systems creation…</li>
</ul>
</section><section>
<!-- ## Build automation: basics and styles

Different lifecycle types generate different build automation **styles**

**Imperative**: write a script that tells the system what to do to get
from code to artifacts
* *Examples*: make, cmake, Apache Ant
* *Abstraction gap*: verbose, repetitive
* Configuration (*declarative*) and actionable (*imperative*) logics *mixed* together
* Highly *configurable*

**Declarative**: adhere to some convention, customizing some settings
* *Examples*: Apache Maven
* Separation between *what* to do and *how* to do it
  * The build system decides how to do the stuff
* *Configuration limited* by the provided options -->
<h2 id="__declarative__-build-automation-systems"><strong>Declarative</strong> build automation systems</h2>
<p>Modern build automation systems are <strong>declarative</strong></p>
<blockquote>
<p><strong>Declarative</strong> software $\approx$ the program describes <em>what</em> to do, not <em>how</em> to do it
<br>
(as opposed to <em>imperative</em> software $\approx$ the program describes <em>how</em> to do it,
<br>
e.g. Python)</p></blockquote>
<p>In other words:</p>
<ul>
<li>they rely on <em>conventions</em> and <em>defaults</em></li>
<li>as long as developers follow them, the configuration is <em>minimal</em></li>
<li>good look if you try to deviate from conventions :)</li>
</ul>
<!-- ---

## Hybrid automators

Create a *declarative infrastructure* upon an *imperative basis*, and
*allow easy access to the underlying machinery*

**Domain-Specific Languages** are helpful in this context: they can "hide" imperativity without ruling it out

Still, many challenges remain open:
* How to reuse the build logic?
    * within a project, and among projects -->
</section><section>
<p>Many modern languages (such as Rust) come with a <em>build automator</em> as <em>part of their distribution</em>.</p>
<h2 id="in-python">In Python</h2>
<p>Python is an <em>interpreted</em> language</p>
<ul>
<li>An arguably old one, too (1991)</li>
<li>Initially used mainly for scripting</li>
<li>No need to compile (as far as the project is pure Python)</li>
<li>Build systems were a less pressing concerns than with other platforms…</li>
</ul>
<p>The need for build systems in Python emerged with more complex use cases</p>
<ul>
<li>Since there were none, now there are several tools that do build-related jobs:</li>
</ul>
<table>
  <thead>
      <tr>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><a href="https://www.anaconda.com/">Anaconda</a></td>
          <td><a href="https://docs.conda.io/en/latest/index.html">Conda</a></td>
          <td><a href="https://docs.conda.io/en/latest/miniconda.html">Miniconda</a></td>
          <td><a href="https://pypi.org/project/pip/">pip</a></td>
      </tr>
      <tr>
          <td><a href="https://python-poetry.org/">Poetry</a></td>
          <td><a href="https://pybuilder.io/">PyBuilder</a></td>
          <td><a href="https://github.com/pyenv/pyenv">PyEnv</a></td>
          <td><a href="https://virtualenv.pypa.io/en/latest/#">virtualenv</a></td>
      </tr>
      <tr>
          <td></td>
          <td></td>
          <td></td>
          <td></td>
      </tr>
  </tbody>
</table>
<ul>
<li>The feature set varies wildly</li>
<li>They are meant to solve different problems!</li>
</ul>
</section><section>
<h2 id="pythons-conflicting-standards">Python’s conflicting standards</h2>
<p><img src="https://imgs.xkcd.com/comics/python_environment.png" alt="xkcd"></p>
<p>Since there were no standard management systems originally,
multiple tools <em>proliferated</em></p>
<ul>
<li>
<p>The Python Packaging Authority (PyPA) is inconsistent in its suggestions:</p>
<ul>
<li>Recommends <a href="https://docs.python.org/3/library/venv.html"><code>venv</code></a></li>
<li>Also recommends <a href="https://pipenv.pypa.io/en/latest/">Pipenv</a> , which uses <a href="https://virtualenv.pypa.io/en/latest/"><code>virtualenv</code></a></li>
<li>Also endorses <a href="https://python-poetry.org/">Poetry</a></li>
</ul>
</li>
<li>
<p>Many Python developers also exploit <a href="https://github.com/pyenv/pyenv">PyEnv</a></p>
</li>
<li>
<p>Many data scientists use <a href="https://www.anaconda.com/">Anaconda</a></p>
</li>
</ul>
</section><section>


<section data-shortcode-section="">
<h2 id="what-are-all-these-tools-pt-1">What are all these tools? (pt. 1)</h2>
<ol>
<li>
<p>By default, Python is installed <em>system-wide</em></p>
<ul>
<li>i.e. there should be <em>one</em> (and <strong>only</strong> one) Python interpreter on the system</li>
</ul>
</li>
<li>
<p>All Python installations come with <code>pip</code>, the <em>package installer</em> for Python</p>
</li>
<li>
<p>So, one may <strong>install</strong> Python packages <em>system-wide</em> with <code>pip install PACKAGE_NAME</code></p>
</li>
</ol>
<blockquote>
<p><strong>One problem, many implications</strong>: the same package can be installed <em>only once</em> on the same Python installation</p>
<ul>
<li><strong>(a)</strong> what if two projects on the same system require <em>different versions</em> of the <em>same package</em> as dependencies?
<ul>
<li>say, <strong>project A</strong> requires <code>Kivy==2.3</code> and <strong>project B</strong> requires <code>Kivy==1.4</code></li>
</ul>
</li>
<li><strong>(b)</strong> what if two projects on the same system require <em>different versions of Python</em>?
<ul>
<li>say, <strong>project A</strong> requires Python <code>3.8</code> and <strong>project B</strong> requires Python <code>3.10</code></li>
</ul>
</li>
</ul></blockquote>
</section><section>
<h2 id="what-are-all-these-tools-pt-2">What are all these tools? (pt. 2)</h2>
<p>(consider reading this page for further details <a href="https://stackoverflow.com/a/41573588">https://stackoverflow.com/a/41573588</a>)</p>
<ol start="4">
<li>
<p><code>virtualenv</code> and <code>venv</code> are tools to create <em>virtual</em> Python installations <em>on the same system</em></p>
<ul>
<li><code>virtualenv</code> is a <em>third-party</em> tool, <code>venv</code> is <em>built-in</em> in Python 3.3 and later</li>
<li>let’s say you have Python <code>v. XXX</code> installed on your system…
<ul>
<li>… these tools let you create other <em>lightweight</em> <strong>copies</strong> of Python <code>v. XXX</code> in other folders
<ul>
<li>the copies are <strong>fresh</strong>, i.e. they <em>no package</em> installed</li>
<li>but one may install <em>different</em> packages in <em>each</em> copy, via <code>pip</code></li>
</ul>
</li>
</ul>
</li>
<li>now you can solve problem <strong>(a)</strong></li>
</ul>
</li>
<li>
<p><code>PyEnv</code> is a tool to manage <em>multiple</em> Python <strong>installations</strong> <em>on the same system</em></p>
<ul>
<li>each installation may use a <em>different version</em> of Python</li>
<li>now you can solve problem <strong>(b)</strong></li>
</ul>
</li>
</ol>
<blockquote>
<p><strong>New problem</strong>: many Python installations on the same system,
<br> each one with a different version of Python, and different packages installed</p></blockquote>
<p>recall all the issues we had in previous lectures?</p>
</section><section>
<h2 id="what-are-all-these-tools-pt-3">What are all these tools? (pt. 3)</h2>
<ol start="6">
<li>
<p>Smart and adequate <strong>convention</strong> to work with Python projects: <strong>1-project-1-Python-env</strong></p>
<ul>
<li>each Python project has its <em>own</em> Python environment …
<ul>
<li>be it virtual or not, as far as it uses the <em>same</em> Python version required by that project</li>
</ul>
</li>
<li>… the environment <em>only</em> contains the packages required by that project</li>
</ul>
</li>
<li>
<p>Achieving this requires developers to be <em>disciplined</em> and <em>meticulous</em></p>
<ul>
<li>other than being proficient with the tools above</li>
</ul>
</li>
<li>
<p><code>Poetry</code> is a tool that aims to <em>automate</em> this process</p>
</li>
</ol>

</section>
</section><section>
<h2 id="from-now-on-lets-use-poetry">From now on, let’s use Poetry</h2>
<blockquote>
<p>Poetry is a <em>declarative</em> tool for <strong>dependency management</strong>, <strong>packaging</strong>, and <strong>release</strong> in Python</p></blockquote>
<ul>
<li>
<p>It handles both <em>dependencies</em> and <em>dev-dependencies</em></p>
<ul>
<li><em>replacing</em> <code>requirements.txt</code> and <code>requirements-dev.txt</code></li>
</ul>
</li>
<li>
<p>It <em>automates</em> the <strong>1-project-1-Python-env</strong> convention</p>
</li>
<li>
<p>It simplifies the <em>packaging</em> process for the project</p>
</li>
<li>
<p>It simplifies the <em>publication</em> process on PyPI (or other software repositories)</p>
</li>
</ul>
</section><section>
<h2 id="poetrys-canonical-project-structure">Poetry’s canonical project structure</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span>root-directory/
</span></span><span style="display:flex;"><span>├── main_package/
</span></span><span style="display:flex;"><span>│&nbsp;&nbsp; ├── __init__.py
</span></span><span style="display:flex;"><span>│&nbsp;&nbsp; ├── sub_module.py
</span></span><span style="display:flex;"><span>│&nbsp;&nbsp; └── sub_package/ 
</span></span><span style="display:flex;"><span>│&nbsp;&nbsp;     ├── __init__.py 
</span></span><span style="display:flex;"><span>│&nbsp;&nbsp;     └── sub_sub_module.py 
</span></span><span style="display:flex;"><span>├── test/
</span></span><span style="display:flex;"><span>│&nbsp;&nbsp; ├── test_something.py
</span></span><span style="display:flex;"><span>│&nbsp;&nbsp; └── test_something_else.py/ 
</span></span><span style="display:flex;"><span>├── pyproject.toml              <span style="color:#8f5902;font-style:italic"># File where project configuration (metadata, dependencies, etc.) is stored</span>
</span></span><span style="display:flex;"><span>├── poetry.toml                 <span style="color:#8f5902;font-style:italic"># File where Poetry configuration is stored</span>
</span></span><span style="display:flex;"><span>├── poetry.lock                 <span style="color:#8f5902;font-style:italic"># File where Poetry locks the dependencies</span>
</span></span><span style="display:flex;"><span>└── README.md
</span></span></code></pre></div><p>Notice that, w.r.t. the canonical project structure we have been using so far:</p>
<ul>
<li>the files <code>requirements.txt</code> and <code>requirements-dev.txt</code> are <strong>not</strong> present any more</li>
<li>the files <code>pyproject.toml</code>, <code>poetry.toml</code>, and <code>poetry.lock</code> are <strong>new entries</strong></li>
<li>the <code>poetry.lock</code> file is generated <em>automatically</em> by Poetry, and you should not edit it</li>
</ul>
</section><section>
<h1 id="example-pt-1">Example (pt. 1)</h1>
<h2 id="the-calculator-repositoryhttpsgithubcomunibo-dtm-secalculator">The <a href="https://github.com/unibo-dtm-se/calculator"><code>calculator</code> repository</a></h2>
<ol>
<li>
<p>Look at the <a href="https://github.com/unibo-dtm-se/calculator/blob/master/pyproject.toml"><code>pyproject.toml</code> file</a></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">tool</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">poetry</span><span style="color:#000;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># name of the package to be published</span>
</span></span><span style="display:flex;"><span><span style="color:#000">name</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#4e9a06">"unibo-dtm-se-calculator"</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># files to be included for publication</span>
</span></span><span style="display:flex;"><span><span style="color:#000">packages</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">{</span> <span style="color:#000">include</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#4e9a06">"calculator"</span> <span style="color:#000;font-weight:bold">},</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># various metadata for publication</span>
</span></span><span style="display:flex;"><span><span style="color:#000">version</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#4e9a06">"0.1.1"</span>
</span></span><span style="display:flex;"><span><span style="color:#000">description</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#4e9a06">"A simple calculator toolkit written in Python, with several UIs. It is part of the Software Engineering course at the University of Bologna."</span>
</span></span><span style="display:flex;"><span><span style="color:#000">authors</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">"Giovanni Ciatto &lt;giovanni.ciatto@unibo.it&gt;"</span><span style="color:#000;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span><span style="color:#000">license</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#4e9a06">"Apache 2.0"</span>
</span></span><span style="display:flex;"><span><span style="color:#000">readme</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#4e9a06">"README.md"</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># dependencies (notice that Python is considered a dependency)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">tool</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">poetry</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">dependencies</span><span style="color:#000;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span><span style="color:#000">python</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#4e9a06">"^3.10.0"</span>
</span></span><span style="display:flex;"><span><span style="color:#000">Kivy</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#4e9a06">"^2.3.0"</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># development dependencies</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">tool</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">poetry</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">group</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">dev</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">dependencies</span><span style="color:#000;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span><span style="color:#000">poetry</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#4e9a06">"^1.7.0"</span>
</span></span><span style="display:flex;"><span><span style="color:#000">pytest</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#4e9a06">"^8.1.0"</span>
</span></span><span style="display:flex;"><span><span style="color:#000">coverage</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#4e9a06">"^7.4.0"</span>
</span></span><span style="display:flex;"><span><span style="color:#000">mypy</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#4e9a06">"^1.9.0"</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># executable commands that will be created then installing this package</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">tool</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">poetry</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">scripts</span><span style="color:#000;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span><span style="color:#000">calculator-gui</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#4e9a06">"calculator.ui.gui:start_app"</span>
</span></span><span style="display:flex;"><span><span style="color:#000">calculator</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#4e9a06">"calculator.ui.cli:start_app"</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># where to download the dependencies from</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">[[</span><span style="color:#000">tool</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">poetry</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">source</span><span style="color:#000;font-weight:bold">]]</span>
</span></span><span style="display:flex;"><span><span style="color:#000">name</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#4e9a06">"PyPI"</span>
</span></span><span style="display:flex;"><span><span style="color:#000">priority</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#4e9a06">"primary"</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># packaging dependencies</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">build-system</span><span style="color:#000;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span><span style="color:#000">requires</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">"poetry-core"</span><span style="color:#000;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span><span style="color:#000">build-backend</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#4e9a06">"poetry.core.masonry.api"</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># mypy configuration</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">tool</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">mypy</span><span style="color:#000;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span><span style="color:#000">ignore_missing_imports</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">true</span>
</span></span></code></pre></div><ul>
<li>learn how to specify dependencies here <a href="https://python-poetry.org/docs/dependency-specification/">https://python-poetry.org/docs/dependency-specification/</a></li>
</ul>
</li>
</ol>
</section><section>
<h1 id="example-pt-2">Example (pt. 2)</h1>
<h2 id="the-calculator-repositoryhttpsgithubcomunibo-dtm-secalculator-1">The <a href="https://github.com/unibo-dtm-se/calculator"><code>calculator</code> repository</a></h2>
<ol start="2">
<li>
<p>Look at the <a href="https://github.com/unibo-dtm-se/calculator/blob/master/poetry.toml"><code>poetry.toml</code> file</a></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># the project-specific environment will be created in the local .venv folder</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">virtualenvs</span><span style="color:#000;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span><span style="color:#000">in-project</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">true</span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># packages produced by poetry may be published on the pypi-test repository</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">repositories</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">pypi-test</span><span style="color:#000;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span><span style="color:#000">url</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#4e9a06">"https://test.pypi.org/legacy/"</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># another implicit repository is always available, namely PyPI</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># at https://pypi.org/</span>
</span></span></code></pre></div></li>
</ol>
</section><section>
<h1 id="exercise-pt-1">Exercise (pt. 1)</h1>
<h2 id="the-calculator-repositoryhttpsgithubcomunibo-dtm-secalculator-2">The <a href="https://github.com/unibo-dtm-se/calculator"><code>calculator</code> repository</a></h2>
<ol>
<li>
<p>Ensure you have Poetry installed on your system</p>
<ul>
<li><a href="https://python-poetry.org/docs/#installing-with-the-official-installer">https://python-poetry.org/docs/#installing-with-the-official-installer</a></li>
<li>run <code>poetry --version</code> to check</li>
</ul>
</li>
<li>
<p><em>Fork</em> the repository</p>
</li>
<li>
<p><em>Clone</em> the repository on your system</p>
<ul>
<li><code>git clone https://github.com/unibo-dtm-se/calculator.git</code></li>
<li>then, open the <code>calculator</code> folder into VS code</li>
</ul>
</li>
<li>
<p>Run <code>poetry install</code> in the terminal. This shall:</p>
<ul>
<li>create a <em>virtual environment</em> in the <code>.venv</code> directory
<ul>
<li>please ensure that a <code>.venv</code> directory <strong>exists</strong> in your project directory, after running this command</li>
</ul>
</li>
<li><em>install</em> the <em>dependencies</em> declared in the <code>pyproject.toml</code> file</li>
<li><em>lock</em> the dependencies in the <code>poetry.lock</code> file</li>
</ul>
</li>
</ol>
</section><section>
<h2 id="dependency-ranges-and-locking">Dependency ranges and locking</h2>
<ul>
<li>A project can depend on a specific version of a library or on a <em>range</em> of versions</li>
<li>We want to be able to specify ranges, but <em>retain the ability to use an exact version</em></li>
</ul>
<blockquote>
<p>This software is compatible with <code>library</code> version 2.3. For our examples, we used version 2.3.<em>10</em></p></blockquote>
<p>Expressing something like this is done via <strong>dependency locking</strong>:</p>
<ul>
<li>Configure the build file with the range of supported versions</li>
<li>Use the build tool to <em>lock</em> the dependencies (pinpoint their version)
<ul>
<li>In practice, create a lock file where the exact version is explicit</li>
</ul>
</li>
<li>Locking usually also locks the <strong>transitive dependencies</strong>!
<ul>
<li>Once locked, we have a snapshot of a working environment</li>
</ul>
</li>
</ul>
<p><a href="https://python-poetry.org/docs/dependency-specification/">Poetry allows range specifications and locks automatically</a></p>
</section><section>
<h1 id="exercise-pt-2">Exercise (pt. 2)</h1>
<h2 id="the-calculator-repositoryhttpsgithubcomunibo-dtm-secalculator-3">The <a href="https://github.com/unibo-dtm-se/calculator"><code>calculator</code> repository</a></h2>
<ol start="5">
<li>
<p>Let’s use a shell in the virtual environment created by Poetry</p>
<ul>
<li>run <code>poetry shell</code></li>
<li>if this operation was fine, you should be able to run the command <code>calculator 1+1</code> to produce <code>2</code> as output
<ul>
<li>if you get an error, please let us know</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Make sure that <em>VS Code</em> is using the <em>same</em> environment as the one created by Poetry.</p>
<ul>
<li>Open the Command Palette (on <i class="fab fa-linux"></i>/<i class="fab fa-windows"></i> press <kbd>Ctrl</kbd>+<kbd>⇧</kbd>+<kbd>P</kbd>, use <kbd>⌘</kbd> instead of <kbd>Ctrl</kbd> on <i class="fab fa-apple"></i> )</li>
<li>Type <code>Python: Select Interpreter</code></li>
<li>Choose the local environment, i.e. the one having path <code>./.venv/bin/python</code></li>
</ul>
</li>
<li>
<p>This is an ordinary project, where you can operate <em>as usual</em></p>
<ul>
<li>run <code>python -m unittest discover -v -s tests</code> in the terminal</li>
<li>try to run tests in the UI, too</li>
</ul>
</li>
</ol>
</section><section>
<h2 id="useful-hints">Useful hints</h2>
<ol>
<li>
<p>So many Python environments in the shell… how to avoid mistakes?</p>
<blockquote>
<p>If you want to be 100% you’re running commands in the <em>right</em> environment, you can prefix them with <code>poetry run</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span>poetry run python -m unittest discover -v -s tests
</span></span></code></pre></div></blockquote>
</li>
<li>
<p>Ok but what about VS Code’s environments?</p>
<blockquote>
<p>Get the habit of configuring the VS Code environment <em>manually</em> when working with Python projects</p></blockquote>
</li>
</ol>
</section><section>
<h1 id="whats-the-value-added-of-poetry">What’s the value added of Poetry?</h1>
<p>It supports publishing.</p>
<blockquote>
<p>Consider the following Web Page:
<br> <a href="https://pypi.org/project/unibo-dtm-se-calculator">https://pypi.org/project/unibo-dtm-se-calculator</a></p></blockquote>
<ul>
<li>
<p>This is the <em>PyPI</em> page of the <code>unibo-dtm-se-calculator</code> package</p>
<ul>
<li>which we published by means of Poetry</li>
</ul>
</li>
<li>
<p>After the project is made available on PyPI, it can be installed by anyone</p>
<ul>
<li>by running <code>pip install unibo-dtm-se-calculator</code></li>
</ul>
</li>
</ul>
</section><section>
<h1 id="exercise">Exercise</h1>
<h2 id="installing-a-published-package-in-a-virgin-environment">Installing a published package in a virgin environment</h2>
<p>Let’s first create a new Python environment, and then install the <code>unibo-dtm-se-calculator</code> package in it</p>
<ol>
<li>
<p>Create a new Python environment (to simulate the <em>initially empty</em> environment of a <em>new</em> developer/user)</p>
<ol>
<li>open a fresh new terminal</li>
<li>create the fresh new environment <code>python -m venv virgin-env</code></li>
<li>activate the environment</li>
</ol>
<ul>
<li>on on <i class="fab fa-linux"></i>/<i class="fab fa-apple"></i> run <code>source virgin-env/bin/activate</code></li>
<li>on <i class="fab fa-windows"></i> use <code>.\virgin-env\Scripts\Activate</code></li>
</ul>
<ol start="3">
<li>if you run commands <code>calculator</code> or <code>calculator-gui</code> they <em>should fail</em></li>
</ol>
</li>
<li>
<p>Install the <code>unibo-dtm-se-calculator</code> package <code>pip install unibo-dtm-se-calculator</code></p>
</li>
<li>
<p>Try now to run the calculator in the shell</p>
<ul>
<li><code>calculator 1+1</code> should produce <code>2</code> as output</li>
<li><code>calculao-gui</code> should open a GUI calculator</li>
</ul>
</li>
</ol>
</section><section>
<h2 id="how-to-publish-python-packages-on-pypi">How to publish Python packages on PyPI</h2>
<h3 id="prerequisites">Prerequisites</h3>
<ul>
<li>
<p>Have an account on <a href="https://pypi.org/">PyPI</a></p>
<ul>
<li>generate an <a href="https://pypi.org/manage/account/">API token</a> for your account</li>
</ul>
</li>
<li>
<p>Have an account on <a href="https://test.pypi.org/">Test-PyPI</a></p>
<ul>
<li>generate an <a href="https://test.pypi.org/manage/account/">API token</a> for your account</li>
</ul>
</li>
</ul>
<h3 id="conceptual-steps">Conceptual steps</h3>
<ol>
<li>
<p>Publish on Test-Pypi, to ensure the procedure works</p>
</li>
<li>
<p>Publish on PyPI</p>
</li>
<li>
<p>Profit</p>
</li>
</ol>
</section><section>
<h2 id="how-to-publish-python-packages-on-test-pypi-with-poetry">How to publish Python packages on Test-PyPI with Poetry</h2>
<ol>
<li>
<p>Build the project, i.e. produce <em>installable package</em> <strong>(only do this after all Q/A checks pass)</strong></p>
<ul>
<li><code>poetry build</code></li>
<li>this will create a <code>.whl</code> file and a <code>.tar.gz</code> file in the <code>dist/</code> directory</li>
</ul>
</li>
<li>
<p>Upload installable packages on Test-PyPI</p>
<ul>
<li><code>poetry publish --repository pypi-test --username __token__ --password TEST_PYPI_API_TOKEN</code>
<ul>
<li><a href="https://pypi.org/help/#apitoken">the username is <em>literally</em> <code>__token__</code></a></li>
<li>the password is the API token you generated on Test-PyPI</li>
</ul>
</li>
<li>this will upload the package to Test-PyPI</li>
</ul>
</li>
<li>
<p>That’s it!</p>
<ul>
<li>visit the page of your package on Test-PyPI</li>
<li>try to install it in a virgin environment via <code>pip install -i https://test.pypi.org/simple/ unibo-dtm-se-calculator</code></li>
</ul>
</li>
</ol>
</section><section>
<h2 id="problems-that-you-may-encounter">Problems that you may encounter</h2>
<ul>
<li>
<p>Building may fail if your <code>pyproject.toml</code> is not properly configured, or missing data</p>
</li>
<li>
<p>Upload may fail:</p>
<ul>
<li>if your credentials are wrong, for some reason</li>
<li>if the package name is already taken</li>
<li>if the package version is already taken</li>
</ul>
</li>
<li>
<p>Installation may fail:</p>
<ul>
<li>because your package has a dependency that is not available on Test-PyPI</li>
</ul>
</li>
</ul>
</section><section>
<h2 id="how-to-publish-python-packages-on-pypi-with-poetry">How to publish Python packages on PyPI with Poetry</h2>
<ol>
<li>
<p>Build the project, i.e. produce <em>installable package</em> <strong>(only do this after all Q/A checks pass)</strong></p>
<ul>
<li><code>poetry build</code></li>
<li>this will create a <code>.whl</code> file and a <code>.tar.gz</code> file in the <code>dist/</code> directory</li>
</ul>
</li>
<li>
<p>Upload installable packages on PyPI</p>
<ul>
<li><code>poetry publish --repository pypi-test --username __token__ --password PYPI_API_TOKEN</code>
<ul>
<li><a href="https://pypi.org/help/#apitoken">the username is <em>literally</em> <code>__token__</code></a></li>
<li>the password is the API token you generated on PyPI</li>
</ul>
</li>
<li>this will upload the package to PyPI</li>
</ul>
</li>
<li>
<p>That’s it!</p>
<ul>
<li>visit the page of your package on PyPI</li>
<li>try to install it in a virgin environment via <code>pip install unibo-dtm-se-calculator</code></li>
</ul>
</li>
</ol>
</section><section>
<h2 id="problems-that-you-may-encounter-1">Problems that you may encounter</h2>
<ul>
<li>
<p>Building may fail if your <code>pyproject.toml</code> is not properly configured, or missing data</p>
<ul>
<li>but you should already have fixed this when publishing on Test-PyPI</li>
</ul>
</li>
<li>
<p>Upload may fail:</p>
<ul>
<li>if your credentials are wrong, for some reason</li>
<li>if the package name is already taken</li>
<li>if the package version is already taken</li>
</ul>
</li>
<li>
<p>Installation may fail, but in this case there must be an issue in the package itself</p>
</li>
</ul>
<!-- --- -->
<!-- ---

# Lessons learned

* Building a piece of software is not just writing code
* Software requires dependencies
* Dependency management is difficult
* All components of a runtime are part of the dependencies
  * Including interpreters
* Build Reproducibility is paramount
* Automatic configuration is desirable
* The Python build ecosystem is fragmented
  * Poetry is a modern take on Python dependency management and packaging
  * PyEnv can be used to let multiple Python versions live together -->
</section><section>
<h1 id="lecture-is-over">Lecture is Over</h1>
<br>
<p>Compiled on: 2025-02-18 — <a href="?print-pdf&amp;pdfSeparateFragments=false"><i class="fa fa-print" aria-hidden="true"></i> printable version</a></p>
<p><a href="../#/toc"><i class="fa fa-undo" aria-hidden="true"></i> back to ToC</a></p>
</section>

  


</div>
      

    </div>
<script type="text/javascript" src="/course-slides/reveal-hugo/object-assign.js"></script>

<a href="/course-slides/reveal-js/dist/print/" id="print-location" style="display: none;"></a>

<script type="application/json" id="reveal-hugo-site-params">{"custom_theme":"custom-theme.scss","custom_theme_compile":true,"custom_theme_options":{"enablesourcemap":true,"targetpath":"css/custom-theme.css"},"height":"1080","highlight_theme":"github","history":true,"mermaid":[{"gitGraph":{"mainBranchName":"master","rotateCommitLabel":true},"startOnLoad":false,"useMaxWidth":false}],"slide_number":true,"theme":"league","transition":"slide","transition_speed":"fast","width":"1920"}</script>
<script type="application/json" id="reveal-hugo-page-params">null</script>

<script src="/course-slides/reveal-js/dist/reveal.js"></script>


  
  
  <script type="text/javascript" src="/course-slides/reveal-js/plugin/markdown/markdown.js"></script>
  
  <script type="text/javascript" src="/course-slides/reveal-js/plugin/highlight/highlight.js"></script>
  
  <script type="text/javascript" src="/course-slides/reveal-js/plugin/zoom/zoom.js"></script>
  
  <script type="text/javascript" src="/course-slides/reveal-js/plugin/notes/notes.js"></script>
  
  
  <script type="text/javascript" src="/course-slides/reveal-js/plugin/notes/notes.js"></script>




<script type="text/javascript">
  
  
  function camelize(map) {
    if (map) {
      Object.keys(map).forEach(function(k) {
        newK = k.replace(/(\_\w)/g, function(m) { return m[1].toUpperCase() });
        if (newK != k) {
          map[newK] = map[k];
          delete map[k];
        }
      });
    }
    return map;
  }

  var revealHugoDefaults = { center: true, controls: true, history: true, progress: true, transition: "slide" };

  var revealHugoPlugins = {
    plugins: [ RevealMarkdown, RevealHighlight, RevealNotes, RevealZoom ]
   };
  var revealHugoSiteParams = JSON.parse(document.getElementById('reveal-hugo-site-params').innerHTML);
  var revealHugoPageParams = JSON.parse(document.getElementById('reveal-hugo-page-params').innerHTML);
  
  var options = Object.assign({},
    camelize(revealHugoDefaults),
    camelize(revealHugoSiteParams),
    camelize(revealHugoPageParams),
    camelize(revealHugoPlugins));
  Reveal.initialize(options);
</script>







  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  





    <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      },
      svg: {
        fontCache: 'global'
      }
    };
</script>

<script type="text/javascript" id="MathJax-script" async="" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>

<script>
  if (/.*?(\?|&)print-pdf/.test(window.location.toString())) {
      var ytVideos = document.getElementsByTagName("iframe")
      for (let i = 0; i < ytVideos.length; i++) {
          var videoFrame = ytVideos[i]
          var isYouTube = /^https?:\/\/(www.)youtube\.com\/.*/.test(videoFrame.src)
          if (isYouTube) {
              console.log(`Removing ${videoFrame.src}`)
              var parent = videoFrame.parentElement
              videoFrame.remove()
              var p = document.createElement('p')
              p.append(
                  document.createTextNode(
                      "There was an embedded video here, but it is disabled in the printed version of the slides."
                  )
              )
              p.append(document.createElement('br'))
              p.append(
                  document.createTextNode(
                      `Visit instead ${
                          videoFrame.src
                      } or ${
                          videoFrame.src.replace(
                              /(^https?:\/\/(www.)youtube\.com)\/(embed\/)(\w+).*/,
                              "https://www.youtube.com/watch?v=$4"
                          )
                      }`
                  )
              )
              parent.appendChild(p)
          }
      }
  }
</script>


    
  

</body></html>