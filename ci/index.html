<!DOCTYPE html><html lang="en"><head>
    <meta charset="utf-8">
<title>Continuous Integration</title>
<meta name="description" content="Make things work, keep them working, move fast">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><link rel="stylesheet" href="/course-slides/reveal-js/dist/reset.css">
<link rel="stylesheet" href="/course-slides/reveal-js/dist/reveal.css">
  <link rel="stylesheet" href="/course-slides/css/custom-theme.min.6aab2a58b3721f38ca11bb13ca57a68f6bcafd5754c1704a12dc68db37ed44fa.css" id="theme"><link rel="stylesheet" href="/course-slides/highlight-js/github.min.css">
<link rel="stylesheet" href="https://raw.githubusercontent.com/DanySK/css-blur-animation/master/blur.css">
<link href="https://fonts.googleapis.com/css?family=Roboto Mono" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Oxygen Mono" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Ubuntu Mono" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
<script src="https://kit.fontawesome.com/81ac037be0.js" crossorigin="anonymous"></script>
<script src="https://unibo-dtm-se.github.io/course-slides//plantuml.js"></script>

  </head>
  <body>
    
    <div class="reveal">
      <div class="slides">
  

    <section><h1 id="continuous-integration">Continuous Integration</h1>
<br>
<h2 id="hahahugoshortcode1s0hbhb">Software Engineering</h2>
<h3 id="for-intelligent-distributed-systems"><strong>(for Intelligent Distributed Systems)</strong></h3>
<h3 id="module-principles-and-methods">Module “Principles and Methods”</h3>
<h4 id="hahahugoshortcode1s1hbhb">A.Y. 2023/2024</h4>
<h5 id="hahahugoshortcode1s2hbhb-reusing-material-made-by-hahahugoshortcode1s3hbhb"><a href="mailto:giovanni.ciatto@unibo.it">Giovanni Ciatto</a> (reusing material made by <a href="mailto:danilo.pianini@unibo.it">Danilo Pianini</a>)</h5>
<br>
<br>
<p>Compiled on: 2025-02-10 — <a href="?print-pdf&amp;pdfSeparateFragments=false"><i class="fa fa-print" aria-hidden="true"></i> printable version</a></p>
<p><a href=".."><i class="fa fa-undo" aria-hidden="true"></i> back</a></p>
</section><section>
<h1 id="continuous-integration-1">Continuous Integration</h1>
<p>The practice of integrating code with a main development line <strong>continuously</strong>
<br>
<em>Verifying</em> that the build remains intact</p>
<ul>
<li>Requires <em>build automation</em> to be in place</li>
<li>Requires <em>testing</em> to be in place</li>
<li>Pivot point of the <em>DevOps</em> practices</li>
<li>Historically introduced by the extreme programming (XP) community</li>
<li>Now widespread in the larger DevOps community</li>
</ul>
</section><section>
<h1 id="the-integration-hell">The Integration Hell</h1>
<ul>
<li>Traditional software development takes several months for <em>“integrating”</em> a couple of years of development</li>
<li>The longer there is no integrated project, the higher the <strong>risk</strong></li>
</ul>
<img src="integration-traditional.png" onerror="this.onerror=null; this.src='../../assets/integration-traditional.png'" width="40%">
$\Rightarrow$
<img src="integration-continuous.png" onerror="this.onerror=null; this.src='../../assets/integration-continuous.png'" width="40%">
</section><section>
<h2 id="microreleases-and-protoduction">Microreleases and protoduction</h2>
<ul>
<li>High frequency integration may lead to high frequency releases
<ul>
<li>Possibly, <em>one per commit</em></li>
<li>Of course, <em>versioning</em> must be appropriate…</li>
</ul>
</li>
</ul>
<p>Traditionally, <strong>protoduction</strong> is jargon for a <em>prototype that ends up in production</em></p>
<table>
  <tbody>
    <tr>
      <td>
        <img src="protoduction.jpg" onerror="this.onerror=null; this.src='../../assets/protoduction.jpg'" width="90%">
      </td><td>
      </td><td>
<ul>
<li>Traditionally used with a <em>negative</em> meaning
<ul>
<li>It implied software
<ul>
<li><em>unfinished</em>,</li>
<li><em>unpolished</em>,</li>
<li><em>badly designed</em></li>
</ul>
</li>
<li>Very common, unfortunately</li>
</ul>
</li>
<li>This is different in a continuously integrated environment
<ul>
<li>
<p><em>Incrementality</em> is fostered</p>
</li>
<li>
<p>Partial features are <em>up to date</em> with the mainline</p>
</li></ul></li></ul></td><td>


  </td></tr>
</tbody>


</table>
</section><section>
<h2 id="intensive-operations-should-be-elsewhere">Intensive operations should be elsewhere</h2>
<ul>
<li>The build process should be <em>rich</em> and <em>fast</em></li>
<li>Operations requiring a long time should be <em>automated</em>
<ul>
<li>And run somewhere else than devs’ PCs</li>
</ul>
</li>
</ul>
<p>
<img src="compiling.png" onerror="this.onerror=null; this.src='../../assets/compiling.png'" height="100%">
</p>
</section><section>
<h2 id="continuous-integration-concept">Continuous integration concept</h2>
<p><img src="./concept.png" alt=""></p>
</section><section>
<h2 id="continuous-integration-software">Continuous integration software</h2>
<h3 id="software-that-promotes-ci-practices-should">Software that promotes CI practices should:</h3>
<ul>
<li>Provide <em>clean environments</em> for compilation/testing</li>
<li>Provide a <em>wide range</em> of environments
<ul>
<li>Matching the relevant specifications of the actual targets</li>
</ul>
</li>
<li>High degree of <em>configurability</em></li>
<li>Possibly, <em>declarative configuration</em></li>
<li>A <em>notification system</em> to alert about failures or issues</li>
<li>Support for <em>authentication</em> and deployment to external services</li>
</ul>
</section><section>
<h2 id="continuous-integration-software-1">Continuous integration software</h2>
<p><strong>Plenty</strong> of technologies on the market</p>
<ul>
<li><a href="https://circleci.com/">Circle CI</a></li>
<li><a href="https://travis-ci.com/">Travis CI</a></li>
<li><a href="https://wercker.com/">Werker</a></li>
<li><a href="https://done.io/">done.io</a></li>
<li><a href="https://codefresh.io/">Codefresh</a></li>
<li><a href="https://codeship.com/">Codeship</a></li>
<li><a href="https://bitbucket.org/product/features/pipelines">Bitbucket Pipelines</a></li>
<li><a href="https://github.com/features/actions">GitHub Actions</a></li>
<li><a href="https://docs.gitlab.com/ee/ci/pipelines/">GitLab CI/CD Pipelines</a></li>
<li><a href="https://www.jetbrains.com/teamcity">JetBrains TeamCity</a></li>
</ul>
<blockquote>
<p>We will use <strong>GitHub Actions</strong>: GitHub integration, <em>free for FOSS</em>, multi-os OSs supported</p></blockquote>
</section><section>
<h1 id="core-concepts">Core concepts</h1>
<p>Naming and organization is variable across platforms, but <em>in general</em>:</p>
<ul>
<li>One or more <strong>pipelines</strong> can be associated to <strong>events</strong>
<ul>
<li>For instance, a <em>new commit</em>, an update to a <em>pull request</em>, or a <em>timeout</em></li>
</ul>
</li>
<li>Every pipeline is composed of a <strong>sequence</strong> of <strong>operations</strong></li>
<li>Every <strong>operation</strong> could be composed of <em>sequential</em> or <em>parallel</em> <strong>sub-operations</strong></li>
<li>How many hierarchical levels are available depends on the specific platform
<ul>
<li>GitHub Actions: <em>workflow</em> $\Rightarrow$ <em>job</em> $\Rightarrow$ <em>step</em></li>
<li>Travis CI: <em>build</em> $\Rightarrow$ <em>stage</em> $\Rightarrow$ <em>job</em>  $\Rightarrow$ <em>phase</em></li>
</ul>
</li>
<li>Execution happens in a <strong>fresh system</strong> (virtual machine or container)
<ul>
<li>Often containers inside virtual machines</li>
<li>The specific point of the hierarchy at which the VM/container is spawned depends on the CI platform</li>
</ul>
</li>
</ul>
</section><section>
<h2 id="pipeline-design">Pipeline design</h2>
<p>In essence, designing a CI system is designing a software construction, verification, and delivery <em>pipeline</em>
with the abstractions provided by the selected provider.</p>
<ol>
<li><strong>Think</strong> of all the operations required starting from one or more <em>blank</em> VMs
<ul>
<li>OS configuration</li>
<li>Software installation</li>
<li>Project checkout</li>
<li>Compilation</li>
<li>Testing</li>
<li>Secrets configuration</li>
<li>Delivery</li>
<li>…</li>
</ul>
</li>
<li><strong>Organize</strong> them in a dependency graph</li>
<li><strong>Model</strong> the graph with the provided CI tooling</li>
</ol>
<p>Configuration can grow complex, and is usually stored in a YAML file
<br>
(but there are exceptions, JetBrains TeamCity uses a Kotlin DSL).</p>
</section><section>
<h2 id="pipeline-design-abstract-example">Pipeline design (abstract example)</h2>
<p><img src="./abstract-workflow.svg" alt=""></p>
<ul>
<li>Rectangles represent <em>operations</em></li>
</ul>
</section><section>
<h2 id="github-actions-structure">GitHub Actions: Structure</h2>
<ul>
<li><strong>Workflows</strong> react to events, launching <em>jobs</em>
<ul>
<li>Multiple workflows run in parallel, unless explicitly restricted</li>
</ul>
</li>
<li><strong>Jobs</strong> of the same workflow run a sequence of <em>steps</em>
<ul>
<li>Multiple jobs run in parallel, unless a dependency among them is explicitly declared</li>
<li>Concurrency limits can be imposed across workflows</li>
<li>They can communicate via outputs</li>
</ul>
</li>
<li><strong>Steps</strong> of the same job run <em>sequentially</em>
<ul>
<li>They can communicate via outputs</li>
</ul>
</li>
</ul>
</section><section>
<h2 id="github-actions-practical-example">GitHub Actions (practical example)</h2>
<p><img src="./actual-workflow.svg" alt=""></p>
<ul>
<li>Small rectangles represent <em>steps</em></li>
<li>Azure boxes represent <em>jobs</em></li>
<li>The whole is a <em>workflow</em></li>
</ul>
</section><section>
<h2 id="github-actions-configuration">GitHub Actions: Configuration</h2>
<ul>
<li>
<p>Workflows are configured in <a href="">YAML files</a> located in the <em>default branch</em> of the repository</p>
<ul>
<li>in the <code>.github/workflows/</code> folder.</li>
</ul>
</li>
<li>
<p>One configuration file $\Rightarrow$ one workflow</p>
</li>
<li>
<p>For security reasons,
workflows may need to get manually activated in the <em>Actions</em> tab of the GitHub web interface.</p>
</li>
</ul>
</section><section>
<h2 id="github-actions-runners">GitHub Actions: Runners</h2>
<ul>
<li>Executors of GitHub actions are called <em>runners</em>
<ul>
<li>virtual machines (hosted by GitHub)
<ul>
<li>with the GitHub Actions runner application installed.</li>
</ul>
</li>
</ul>
</li>
</ul>
<blockquote>
<p><strong>Note</strong>: the GitHub Actions application is open source and can be installed locally,
creating “<em>self-hosted runners</em>”. Self-hosted and GitHub-hosted runners can work together.</p></blockquote>
<ul>
<li>
<p>Upon their creation, runners have a default environment</p>
<ul>
<li>which depends on their <em>operating system</em></li>
</ul>
</li>
<li>
<p>Documentation available at <a href="https://docs.github.com/en/actions/using-github-hosted-runners/about-github-hosted-runners#preinstalled-software">https://docs.github.com/en/actions/using-github-hosted-runners/about-github-hosted-runners#preinstalled-software</a></p>
</li>
</ul>
</section><section>
<h2 id="convention-over-configuration">Convention over configuration</h2>
<p>Several CI systems inherit the “<em>convention over configuration</em>” principle.</p>
<blockquote>
<p>GitHub actions <strong>does not</strong> adhere to the principle:
if left unconfigured, the runner does nothing
(it does not even clone the repository locally).</p></blockquote>
<ul>
<li><strong>Probable reason</strong>: Actions is an <em>all-round</em> repository automation system for GitHub,
<ul>
<li>not just a “plain” CI/CD pipeline</li>
<li>$\Rightarrow$ it can react to many different events, not just changes to the git repository history</li>
</ul>
</li>
</ul>
</section><section>
<h2 id="gha-basic-workflow-structure">GHA: basic workflow structure</h2>
<p>Minimal, simplified workflow structure:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Mandatory workflow name</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Workflow Name</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">on</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Events that trigger the workflow</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">jobs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Jobs composing the workflow, each one will run on a different runner</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Job-Name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Every job must be named</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#8f5902;font-style:italic"># The type of runner executing the job, usually the OS</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">runs-on</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">runner-name</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">steps</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># A list of commands, or "actions"</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span>- <span style="color:#8f5902;font-style:italic"># first step</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span>- <span style="color:#8f5902;font-style:italic"># second step</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Another-Job</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># This one runs in parallel with Job-Name</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">runs-on</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">'...'</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">steps</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">... ]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div></section><section>
<h2 id="workflow-minimal-example">Workflow minimal example</h2>
<p><a href="https://github.com/unibo-dtm-se/calculator/blob/master/.github/workflows/check.yml">Consider <code>check.yml</code> file on the <code>calculator</code> repository</a>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">CI/CD</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">on</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">push</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">paths-ignore</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#4e9a06">'.gitignore'</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#4e9a06">'CHANGELOG.md'</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#4e9a06">'LICENSE'</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#4e9a06">'README.md'</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">pull_request</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">workflow_dispatch</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">jobs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">test</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">strategy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">fail-fast</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">false</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">matrix</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">os</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- <span style="color:#000">ubuntu-latest</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- <span style="color:#000">windows-latest</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- <span style="color:#000">macos-latest</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">python-version</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- <span style="color:#4e9a06">'3.10'</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- <span style="color:#4e9a06">'3.11'</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- <span style="color:#4e9a06">'3.12'</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">runs-on</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">${{ matrix.os }}</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Test on Python ${{ matrix.python-version }}, on ${{ matrix.os }}</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">timeout-minutes</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">45</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">steps</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Setup Python</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">uses</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">actions/setup-python@v5</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">with</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">python-version</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">${{ matrix.python-version }}</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Install poetry</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">run</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">pip install poetry</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Checkout code</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">uses</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">actions/checkout@v4</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Restore Python dependencies</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">run</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">poetry install</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Test</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">shell</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">bash</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">run</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">poetry run python -m unittest discover -v -s tests</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">release</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">needs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">test</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">if</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">github.ref == 'refs/heads/master'</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">runs-on</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ubuntu-latest</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Release on PyPI and GitHub</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">permissions</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">contents</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">write</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">steps</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Checkout code</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">uses</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">actions/checkout@v4</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">with</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">fetch-depth</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">token</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">${{ secrets.GITHUB_TOKEN }}</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Install poetry</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">run</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">pip install poetry</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Restore Python dependencies</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">run</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">poetry install</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Bump version</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">shell</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">bash</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">run</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">poetry run python bump_version.py --apply | tee CHANGELOG.md</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Commit version change</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">shell</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">bash</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">run</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">|</span><span style="color:#8f5902;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">          git config user.name "${{ github.actor }}"
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">          git config user.email "${{ github.actor }}@users.noreply.github.com"  
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">          git add pyproject.toml
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">          git commit -m "chore(release): v.$(poetry version --short) [skip ci]"</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Build Python Package</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">run</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">poetry build</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Push changes</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">run</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">git push</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Publish on TestPyPI</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">run</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">poetry publish --repository pypi-test --username __token__ --password ${{ secrets.TEST_PYPI_TOKEN }}</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Create GitHub Release</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">shell</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">bash</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">run</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">|</span><span style="color:#8f5902;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">          RELEASE_TAG=$(poetry version --short)
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">          gh release create $RELEASE_TAG dist/* -t v$RELEASE_TAG -F CHANGELOG.md</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">env</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">GITHUB_TOKEN</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">${{ secrets.GITHUB_TOKEN }}</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div></section><section>
<h2 id="checking-out-the-repository">Checking out the repository</h2>
<p>By default, GitHub actions’ <em>runners do <strong>not</strong> check out the repository</em></p>
<ul>
<li>Actions may not need to access the code
<ul>
<li>e.g., Actions automating issues, projects</li>
</ul>
</li>
</ul>
<p>It is a <em>common</em> and <em>non-trivial</em> operation (the checked out version must be the version originating the workflow), thus GitHub provides an action:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""></code></pre></div>
<p>Since actions typically do not need the entire history of the project, by default the action checks out <em>only the commit that originated the workflow</em> (<code>--depth=1</code> when cloning)</p>
<ul>
<li><em>Shallow cloning</em> has better <em>performance</em></li>
<li>$\Rightarrow$ It may break operations that rely on the entire history!
<ul>
<li>e.g., the git-sensitive semantic versioning system</li>
</ul>
</li>
</ul>
<p>Also, <em><strong>tags</strong> don’t get checked out</em></p>
</section><section>
<h2 id="writing-outputs">Writing outputs</h2>
<p>Communication with the runner happens via <em><a href="https://docs.github.com/en/actions/using-workflows/workflow-commands-for-github-actions">workflow commands</a></em>
<br>
The simplest way to create outputs for actions is to print on standard output a message in the form:
<br>
<code>"{name}={value}"</code>
<br>
and redirect it to the end of the file stored in the <code>$GITHUB_OUTPUT</code> environment variable:
<code>echo "{name}={value}" &gt;&gt; $GITHUB_OUTPUT</code></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""></code></pre></div>
</section><section>
<h2 id="build-matrix">Build matrix</h2>
<p>Most software products are meant to be <em>portable</em></p>
<ul>
<li>Across operating systems</li>
<li>Across different frameworks and languages</li>
<li>Across runtime configuration</li>
</ul>
<p>A good continuous integration pipeline should test <em>all the supported combinations</em>*</p>
<ul>
<li>or a sample, if the performance is otherwise unbearable</li>
</ul>
<p>The solution is the adoption of a <strong>build matrix</strong></p>
<ul>
<li>Build variables and their allowed values are specified</li>
<li>The CI integrator generates the <em>cartesian product</em> of the variable values, and launches a build for each!</li>
<li>Note: there is no built-in feature to exclude some combination
<ul>
<li>It must be done manually using <code>if</code> conditionals</li>
</ul>
</li>
</ul>
</section><section>
<h2 id="build-matrix-in-gha">Build matrix in GHA</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""></code></pre></div>
</section><section>
<h2 id="private-data-and-continuous-integration">Private data and continuous integration</h2>
<p>We would like the CI to be able to</p>
<ul>
<li>Sign our artifacts</li>
<li>Delivery/Deploy our artifacts on remote targets</li>
</ul>
<p>Both operations <strong>require private information to be shared</strong></p>
<p>Of course, private data <em>can’t be shared</em></p>
<ul>
<li>Attackers may steal the identity</li>
<li>Attackers may compromise deployments</li>
<li>In case of open projects, attackers may exploit <em>pull requests</em>!
<ul>
<li>Fork your project (which has e.g. a secret environment variable)</li>
<li>Print the value of the secret (e.g. with <code>printenv</code>)</li>
</ul>
</li>
</ul>
<p>How to <em>share a secret</em> with the build environment?</p>
</section><section>
<h2 id="secrets">Secrets</h2>
<p>Secrets can be stored in GitHub at the repository or organization level.</p>
<p>GitHub Actions can access these secrets from the context:</p>
<ul>
<li>Using the <code>secrets.&lt;secret name&gt;</code> context object</li>
<li>Access is allowed only for workflows generated by local events
<ul>
<li>Namely, no secrets for pull requests</li>
</ul>
</li>
</ul>
<p>Secrets can be added from the web interface (for mice lovers), or via the GitHub API.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#!/usr/bin/env ruby</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">require</span> <span style="color:#4e9a06">'rubygems'</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">require</span> <span style="color:#4e9a06">'bundler/setup'</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">require</span> <span style="color:#4e9a06">'octokit'</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">require</span> <span style="color:#4e9a06">'rbnacl'</span>
</span></span><span style="display:flex;"><span><span style="color:#000">repo_slug</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87">name</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">ARGV</span>
</span></span><span style="display:flex;"><span><span style="color:#000">client</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Octokit</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">Client</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">new</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">:access_token</span> <span style="color:#ce5c00;font-weight:bold">=&gt;</span> <span style="color:#4e9a06">'access_token_from_github'</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">pubkey</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">client</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">get_public_key</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">repo_slug</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">key</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Base64</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">decode64</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">pubkey</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">key</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">sodium_box</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">RbNaCl</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">Boxes</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">Sealed</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">from_public_key</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">key</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">encrypted_value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Base64</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">strict_encode64</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">sodium_box</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">encrypt</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">value</span><span style="color:#000;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span><span style="color:#000">payload</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#4e9a06">'key_id'</span> <span style="color:#ce5c00;font-weight:bold">=&gt;</span> <span style="color:#000">pubkey</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">key_id</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">'encrypted_value'</span> <span style="color:#ce5c00;font-weight:bold">=&gt;</span> <span style="color:#000">encrypted_value</span> <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">client</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">create_or_update_secret</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">repo_slug</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87">name</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">payload</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div></section><section>
<h1 id="stale-builds">Stale builds</h1>
<ol>
<li>Stuff <em>works</em></li>
<li><em>Nobody touches it</em> for months</li>
<li>Untouched stuff is now <em>borked</em>!</li>
</ol>
<br>
<ul>
<li>Connected to the issue of <strong>build reproducibility</strong>
<ul>
<li>The higher the build <em>reproducibility</em>, the higher its <em>robustness</em></li>
</ul>
</li>
<li>The default runner configuration may change</li>
<li>Some tools may become unavailable</li>
<li>Some dependencies may get unavailable</li>
</ul>
<p><strong>The sooner the issue is known, the better</strong></p>
<p>$\Rightarrow$ <em>Automatically run the build every some time</em> even if nobody touches the project</p>
<ul>
<li>How often? Depends on the project…</li>
<li><strong>Warning</strong>: GitHub Actions disables <code>cron</code> CI jobs if there is no action on the repository, which makes the mechanism less useful</li>
</ul>
</section><section>
<h2 id="additional-checks-and-reportings">Additional checks and reportings</h2>
<p>There exist a number of recommended services that provide additional QA and reports.</p>
<p>Non exhaustive list:</p>
<ul>
<li><a href="https://codecov.io/">Codecov.io</a>
<ul>
<li>Code coverage</li>
<li>Supports Jacoco XML reports</li>
<li>Nice data reporting system</li>
</ul>
</li>
<li><a href="https://sonarcloud.io/">Sonarcloud</a>
<ul>
<li>Multiple measures, covering reliability, security, maintainability, duplication, complexity…</li>
</ul>
</li>
<li><a href="https://www.codacy.com/">Codacy</a>
<ul>
<li>Automated software QA for several languages</li>
</ul>
</li>
<li><a href="https://www.codefactor.io/">Code Factor</a>
<ul>
<li>Automated software QA</li>
</ul>
</li>
</ul>
</section><section>
<h2 id="high-quality-floss-checklist">High quality FLOSS checklist</h2>
<p>The <a href="https://www.linuxfoundation.org/">Linux Foundation</a> <a href="https://www.coreinfrastructure.org/">Core Infrastructure Initiative</a> created a checklist for high quality FLOSS.</p>
<p><strong><a href="https://bestpractices.coreinfrastructure.org/en">CII Best Practices Badge Program https://bestpractices.coreinfrastructure.org/en</a></strong></p>
<ul>
<li><em>Self-certification</em>: no need for bureaucracy</li>
<li>Provides a nice <em>TODO list</em> for a high quality product</li>
<li>Releases a <em>badge</em> that can be added e.g. to the project homepage</li>
</ul>
</section><section>
<h2 id="automated-evolution">Automated evolution</h2>
<p>A full-fledged CI system allows reasonably safe <em>automated evolution of software</em>
<br>
At least, in terms of <em>dependency updates</em></p>
<p>Assuming that you can <em>effectively intercept issues</em>,
here is a possible workflow for <strong>automatic</strong> dependency updates:</p>
<ol>
<li><em>Check</em> if there are new updates</li>
<li><em>Apply</em> the update in a new branch</li>
<li><em>Open</em> a pull request</li>
<li><em>Verify</em> if changes break anything
<ul>
<li>If they do, manual intervention is required</li>
</ul>
</li>
<li><em>Merge</em></li>
</ol>
</section><section>
<h2 id="automated-evolution-1">Automated evolution</h2>
<p><strong>Bots</strong> performing the aforementioned process for a variety of build systems exist.</p>
<p>They are usually integrated with the repository hosting provider</p>
<ul>
<li>Whitesource Renovate (Multiple)
<ul>
<li>Also updates github actions and Gradle Catalogs</li>
</ul>
</li>
<li>Dependabot (Multiple)</li>
<li>Gemnasium (Ruby)</li>
<li>Greenkeeper (NPM)</li>
</ul>
</section>

  


</div>
      

    </div>
<script type="text/javascript" src="/course-slides/reveal-hugo/object-assign.js"></script>

<a href="/course-slides/reveal-js/dist/print/" id="print-location" style="display: none;"></a>

<script type="application/json" id="reveal-hugo-site-params">{"custom_theme":"custom-theme.scss","custom_theme_compile":true,"custom_theme_options":{"enablesourcemap":true,"targetpath":"css/custom-theme.css"},"height":"1080","highlight_theme":"github","history":true,"mermaid":[{"gitGraph":{"mainBranchName":"master","rotateCommitLabel":true},"startOnLoad":false,"useMaxWidth":false}],"slide_number":true,"theme":"league","transition":"slide","transition_speed":"fast","width":"1920"}</script>
<script type="application/json" id="reveal-hugo-page-params">null</script>

<script src="/course-slides/reveal-js/dist/reveal.js"></script>


  
  
  <script type="text/javascript" src="/course-slides/reveal-js/plugin/markdown/markdown.js"></script>
  
  <script type="text/javascript" src="/course-slides/reveal-js/plugin/highlight/highlight.js"></script>
  
  <script type="text/javascript" src="/course-slides/reveal-js/plugin/zoom/zoom.js"></script>
  
  <script type="text/javascript" src="/course-slides/reveal-js/plugin/notes/notes.js"></script>
  
  
  <script type="text/javascript" src="/course-slides/reveal-js/plugin/notes/notes.js"></script>




<script type="text/javascript">
  
  
  function camelize(map) {
    if (map) {
      Object.keys(map).forEach(function(k) {
        newK = k.replace(/(\_\w)/g, function(m) { return m[1].toUpperCase() });
        if (newK != k) {
          map[newK] = map[k];
          delete map[k];
        }
      });
    }
    return map;
  }

  var revealHugoDefaults = { center: true, controls: true, history: true, progress: true, transition: "slide" };

  var revealHugoPlugins = {
    plugins: [ RevealMarkdown, RevealHighlight, RevealNotes, RevealZoom ]
   };
  var revealHugoSiteParams = JSON.parse(document.getElementById('reveal-hugo-site-params').innerHTML);
  var revealHugoPageParams = JSON.parse(document.getElementById('reveal-hugo-page-params').innerHTML);
  
  var options = Object.assign({},
    camelize(revealHugoDefaults),
    camelize(revealHugoSiteParams),
    camelize(revealHugoPageParams),
    camelize(revealHugoPlugins));
  Reveal.initialize(options);
</script>







  
  

  
  

  
  

  
    
  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  



  <script src="https://cdn.jsdelivr.net/npm/mermaid@10.9.3/dist/mermaid.min.js"></script>
  <script>
    mermaid.initialize({"gitGraph":{"mainBranchName":"master","rotateCommitLabel":true},"startOnLoad":false,"useMaxWidth":false});

    let render = (event) => {
      let mermaidElems = event.currentSlide.querySelectorAll('.mermaid');
      if (!mermaidElems.length){
          return
      }
      mermaidElems.forEach(mermaidElem => {
          let processed = mermaidElem.getAttribute('data-processed');
          if (!processed){
              
              mermaid.init(undefined, mermaidElem);
          }
      });
    };
    
    render({currentSlide: Reveal.getCurrentSlide()});

    Reveal.on('slidechanged', render);
    Reveal.on('ready', render);
  </script>



    <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      },
      svg: {
        fontCache: 'global'
      }
    };
</script>

<script type="text/javascript" id="MathJax-script" async="" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>

<script>
  if (/.*?(\?|&)print-pdf/.test(window.location.toString())) {
      var ytVideos = document.getElementsByTagName("iframe")
      for (let i = 0; i < ytVideos.length; i++) {
          var videoFrame = ytVideos[i]
          var isYouTube = /^https?:\/\/(www.)youtube\.com\/.*/.test(videoFrame.src)
          if (isYouTube) {
              console.log(`Removing ${videoFrame.src}`)
              var parent = videoFrame.parentElement
              videoFrame.remove()
              var p = document.createElement('p')
              p.append(
                  document.createTextNode(
                      "There was an embedded video here, but it is disabled in the printed version of the slides."
                  )
              )
              p.append(document.createElement('br'))
              p.append(
                  document.createTextNode(
                      `Visit instead ${
                          videoFrame.src
                      } or ${
                          videoFrame.src.replace(
                              /(^https?:\/\/(www.)youtube\.com)\/(embed\/)(\w+).*/,
                              "https://www.youtube.com/watch?v=$4"
                          )
                      }`
                  )
              )
              parent.appendChild(p)
          }
      }
  }
</script>


    
  

</body></html>