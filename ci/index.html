<!DOCTYPE html><html lang="en"><head>
    <meta charset="utf-8">
<title>Continuous Integration</title>
<meta name="description" content="Make things work, keep them working, move fast">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><link rel="stylesheet" href="/course-slides/reveal-js/dist/reset.css">
<link rel="stylesheet" href="/course-slides/reveal-js/dist/reveal.css">
  <link rel="stylesheet" href="/course-slides/css/custom-theme.min.3bee906a09133576f8ef092100894160e8353673dfec5c3b5e6c6a2c025152eb.css" id="theme"><link rel="stylesheet" href="/course-slides/highlight-js/github.min.css">
<link rel="stylesheet" href="https://raw.githubusercontent.com/DanySK/css-blur-animation/master/blur.css">
<link href="https://fonts.googleapis.com/css?family=Roboto Mono" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Oxygen Mono" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Ubuntu Mono" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
<script src="https://kit.fontawesome.com/81ac037be0.js" crossorigin="anonymous"></script>
<script src="https://unibo-dtm-se.github.io/course-slides//plantuml.js"></script>

  </head>
  <body>
    
    <div class="reveal">
      <div class="slides">
  

    <section><h1 id="continuous-integration">Continuous Integration</h1>
<br>
<h2 style="margin-bottom: 0;">Software Engineering</h2>
<h3 id="for-intelligent-distributed-systems"><strong>(for Intelligent Distributed Systems)</strong></h3>
<h4 id="hahahugoshortcode1s1hbhb">A.Y. 2024/2025</h4>
<h5 id="hahahugoshortcode1s2hbhb-reusing-material-made-by-hahahugoshortcode1s3hbhb"><a href="mailto:giovanni.ciatto@unibo.it">Giovanni Ciatto</a> (reusing material made by <a href="mailto:danilo.pianini@unibo.it">Danilo Pianini</a>)</h5>
<br>
<br>
<p>Compiled on: 2025-06-17 — <a href="?print-pdf&amp;pdfSeparateFragments=false"><i class="fa fa-print" aria-hidden="true"></i> printable version</a></p>
<p><a href="../#/toc"><i class="fa fa-undo" aria-hidden="true"></i> back</a></p>
</section><section>
<h1 id="continuous-integration-1">Continuous Integration</h1>
<p>The practice of integrating code with a main development line <strong>continuously</strong>
<br>
<em>Verifying</em> that the build remains intact</p>
<ul>
<li>Requires <em>build automation</em> to be in place</li>
<li>Requires <em>testing</em> to be in place</li>
<li>Pivot point of the <em>DevOps</em> practices</li>
<li>Historically introduced by the extreme programming (XP) community</li>
<li>Now widespread in the larger DevOps community</li>
</ul>
</section><section>
<!-- ## Microreleases and protoduction

* High frequency integration may lead to high frequency releases
    * Possibly, *one per commit*
    * Of course, *versioning* must be appropriate...

Traditionally, **protoduction** is jargon for a *prototype that ends up in production*

<table>
  <tbody>
    <tr>
      <td>
        <img src="protoduction.jpg" onerror="this.onerror=null; this.src='../../assets/protoduction.jpg'" width=90% />
      <td/>
      <td>

* Traditionally used with a *negative* meaning
    * It implied software
        * *unfinished*,
        * *unpolished*,
        * *badly designed*
    * Very common, unfortunately
* This is different in a continuously integrated environment
    * *Incrementality* is fostered
    * Partial features are *up to date* with the mainline

      <td/>
    </tr>
  </tbody>
</table> -->
<h2 id="what-is-integration-in-the-first-place">What is integration in the first place?</h2>
<ol>
<li>
<p>Not just simply <strong>merging</strong> code from different <em>branches</em>/developers…</p>
</li>
<li>
<p>… but actually also <strong>building</strong> the software, with all its <em>dependencies</em>…</p>
<ul>
<li>restoring dependencies</li>
<li>compiling</li>
<li>linking</li>
<li>packaging</li>
</ul>
</li>
<li>
<p>… and <strong>testing</strong> the software</p>
<ul>
<li>all sorts of <em>automated tests</em>: unit, integration, system, etc.</li>
<li>possibly, also <em>deployment</em> and <em>release</em> procedures</li>
</ul>
</li>
<li>
<p>for the sake of <em>checking</em> that the software as a whole is still <em>working</em> despite the changes since the last release</p>
</li>
<li>
<p>possibly, doing further <strong>adjustments</strong> to the software <em>code</em> if necessary</p>
<ul>
<li>e.g., if the component is <em>not working</em> any more, or if the <em>tests are failing</em>, etc.</li>
<li>here code may also include <em>configuration</em> files or <em>build</em>, <em>test</em>, or <em>deployment</em> scripts</li>
</ul>
</li>
</ol>
</section><section>
<h1 id="the-integration-hell">The integration hell</h1>
<ul>
<li>Traditional software development takes several months for <em>“integrating”</em> a couple of years of development</li>
<li>The longer there is no integrated project, the higher the <strong>risk</strong></li>
</ul>
<img src="integration-traditional.png" onerror="this.onerror=null; this.src='../../assets/integration-traditional.png'" width="40%">
$\Rightarrow$
<img src="integration-continuous.png" onerror="this.onerror=null; this.src='../../assets/integration-continuous.png'" width="40%">
</section><section>
<h2 id="how-to-make-the-integration-_continuous_">How to make the integration <em>continuous</em>?</h2>
<ol>
<li>
<p><strong>Repeat</strong> the integration process as <em>frequently as possible</em></p>
<ul>
<li>ideally, as frequently as <em>every commit</em>, in practice, as frequently as <strong>every push</strong> to GitHub</li>
</ul>
</li>
<li>
<p>This implies running <em>build</em>, <em>testing</em>, and <em>deployment</em> processes <strong>very frequently</strong> as well</p>
<ul>
<li>which is only possible if the entire process is <strong>automated</strong>
<ul>
<li>which is only possible if _<em>automatic tests</em> are available, as well as <em>build automation</em> scripts, and <em>automatic release/deployment</em> scripts</li>
</ul>
</li>
<li>of course, retrospective adjustments are <em>hard to automate</em>, and should be done <em>manually</em></li>
</ul>
</li>
<li>
<p>Do not rely on the assumption that developers will <em>always</em> <strong>remember</strong> to run these steps consistently before pushing</p>
<ul>
<li>they will not, and they will forget to do it at some point</li>
<li>so we also need to <em>automate</em> the <strong>triggerig</strong> of the <em>build</em>, <em>testing</em>, and <em>deployment</em> processes</li>
</ul>
</li>
<li>
<p>Once the entire process is automated, there are <strong>further benefits</strong>:</p>
<ul>
<li>integration <em>issues</em> can be <em>spotted ASAP</em></li>
<li>the process can be repeated on <em>different platforms</em> (e.g. different OSs, and different versions of Python)
<ul>
<li>which is far more than what a developer can do on their own</li>
</ul>
</li>
<li>emails and notifications can be sent upon <em>failures</em> of the process</li>
</ul>
</li>
</ol>
</section><section>
<h2 id="continous-integration-concept">Continous integration concept</h2>
<ul>
<li>The build process should be <em>rich</em> (comprehensive), <em>fast</em>, and <strong>automated</strong></li>
<li>And run on <em>another machine</em> (or VM) than the developer’s one
<ul>
<li>this is to avoid the developer from being <em>unable to work</em> while the build is running</li>
<li>but also to ensure that the software runs <em>outside</em> from the <em>developer’s environment</em>
<ul>
<li>which increases the chances that the software will run on <em>other</em> machines as well</li>
</ul>
</li>
<li>to allow for testing the software onto many, <em>controlled environments</em>
<ul>
<li>which in turns allows for giving <em>compatibility guarantees</em> to the customers/users</li>
</ul>
</li>
</ul>
</li>
</ul>

<div class="container w-100 m-0 p-0">
    <div class="row "><div class="col "><img src="compiling.png" onerror="this.onerror=null; this.src='../../assets/compiling.png'" height="100%">
</div>
<div class="col "><img src="./concept2.png" alt="Continuous integration concept" style="width: 100%; max-width: 95vw; max-height: 80vh; object-fit: contain; ">
</div>
</div>
</div>
</section><section>
<h2 id="continuous-integration-software">Continuous integration software</h2>
<h3 id="software-that-promotes-ci-practices-should">Software that promotes CI practices should:</h3>
<ul>
<li>Provide <em>clean environments</em> for compilation/testing</li>
<li>Provide a <em>wide range</em> of environments
<ul>
<li>Matching the relevant specifications of the actual targets</li>
</ul>
</li>
<li>High degree of <em>configurability</em></li>
<li>Possibly, <em>declarative configuration</em></li>
<li>A <em>notification system</em> to alert about failures or issues</li>
<li>Support for <em>authentication</em> and deployment to external services</li>
</ul>
</section><section>
<h2 id="continuous-integration-software-1">Continuous integration software</h2>
<p><strong>Plenty</strong> of technologies on the market</p>
<ul>
<li><a href="https://circleci.com/">Circle CI</a></li>
<li><a href="https://travis-ci.com/">Travis CI</a></li>
<li><a href="https://wercker.com/">Werker</a></li>
<li><a href="https://done.io/">done.io</a></li>
<li><a href="https://codefresh.io/">Codefresh</a></li>
<li><a href="https://codeship.com/">Codeship</a></li>
<li><a href="https://bitbucket.org/product/features/pipelines">Bitbucket Pipelines</a></li>
<li><a href="https://github.com/features/actions">GitHub Actions</a></li>
<li><a href="https://docs.gitlab.com/ee/ci/pipelines/">GitLab CI/CD Pipelines</a></li>
<li><a href="https://www.jetbrains.com/teamcity">JetBrains TeamCity</a></li>
</ul>
<blockquote>
<p>We will use <strong>GitHub Actions</strong>: GitHub integration, <em>free for FOSS</em>, multi-os OSs supported</p></blockquote>
</section><section>
<h1 id="core-concepts">Core concepts</h1>
<p>Naming and organization is variable across different technological, but <em>in general</em>:</p>
<ul>
<li>One or more <strong>pipelines</strong> can be associated to <strong>events</strong>
<ul>
<li>For instance, a <em>new commit</em>, an update to a <em>pull request</em>, or a <em>timeout</em></li>
</ul>
</li>
<li>Every pipeline is composed of a <strong>sequence</strong> of <strong>operations</strong></li>
<li>Every <strong>operation</strong> could be composed of <em>sequential</em> or <em>parallel</em> <strong>sub-operations</strong></li>
<li>How many hierarchical levels are available depends on the specific platform
<ul>
<li>GitHub Actions: <em>workflow</em> $\Rightarrow$ <em>job</em> $\Rightarrow$ <em>step</em></li>
<li>Travis CI: <em>build</em> $\Rightarrow$ <em>stage</em> $\Rightarrow$ <em>job</em>  $\Rightarrow$ <em>phase</em></li>
</ul>
</li>
<li>Execution happens in a <strong>fresh system</strong> (virtual machine or container)
<ul>
<li>Often containers inside virtual machines</li>
<li>The specific point of the hierarchy at which the VM/container is spawned depends on the CI platform</li>
</ul>
</li>
</ul>
</section><section>
<h2 id="pipeline-design">Pipeline design</h2>
<p>In essence, designing a CI system is designing a software construction, verification, and delivery <em>pipeline</em>
with the abstractions provided by the selected provider.</p>
<ol>
<li><strong>Think</strong> of all the operations required starting from one or more <em>blank</em> VMs
<ul>
<li>OS configuration</li>
<li>Software installation</li>
<li>Project checkout</li>
<li>Compilation</li>
<li>Testing</li>
<li>Secrets configuration</li>
<li>Delivery</li>
<li>…</li>
</ul>
</li>
<li><strong>Organize</strong> them in a dependency graph</li>
<li><strong>Model</strong> the graph with the provided CI tooling</li>
</ol>
<p>Configuration can grow complex, and is usually stored in a YAML file
<br>
(but there are exceptions, JetBrains TeamCity uses a Kotlin DSL).</p>
</section><section>
<h2 id="pipeline-design-abstract-example">Pipeline design (abstract example)</h2>
<p><img src="./abstract-workflow.svg" alt=""></p>
<ul>
<li>Rectangles represent <em>operations</em></li>
</ul>
</section><section>
<h2 id="github-actions-gha-structure">GitHub Actions (GHA): Structure</h2>
<ul>
<li>
<p><strong>Workflows</strong> are groups of one or many <em>jobs</em></p>
<ul>
<li>triggered by events such as: a developer <em>pushing</em> on the repository, a <em>pull request</em> being opened, a <em>timeout</em>, a <em>manual</em> trigger, etc.</li>
<li>multiple workflows run in parallel, unless specified otherwise by whoever designed the workflows</li>
</ul>
</li>
<li>
<p><strong>Jobs</strong> is a sequential list of logical <em>steps</em></p>
<ul>
<li>different jobs from the same workflow run in <em>parallel</em>, unless a <em>dependency</em> among them is explicitly declared
<ul>
<li>in case of a dependency, the <em>dependent</em> job will run <em>only after</em> the dependency job is <em>completed successfully</em></li>
</ul>
</li>
<li>steps of the same job run in the <em>exact same order</em> as they are defined in the job</li>
<li>each job runs inside a <em>fresh</em> new <strong>Virtual Machine</strong> (VM), with a <em>selectable OS</em>
<ul>
<li>most common development tools (e.g. Git, Python, Poetry, etc.) are pre-installed by default…</li>
<li>but further may be installed if needed (e.g. <code>MySQL</code>, <code>PostgreSQL</code>, etc.)</li>
</ul>
</li>
<li>the VM is <em>destroyed</em> after the job is completed
<ul>
<li>users can see the <em>logs</em> of the job execution</li>
<li>any relevant data produced by the job must be explicitly saved <em>elsewhere</em> (as part of the job), otherwise it will be lost</li>
</ul>
</li>
<li>[IMPORTANT] jobs can be configured to run <em>multiple times</em> with different OS/runtimes: this is the <strong>matrix</strong> execution strategy</li>
</ul>
</li>
<li>
<p><strong>Steps</strong> is just executing a <em>command</em> in the <em>shell</em> of the job’s VM</p>
<ul>
<li>e.g. cloning the repository via <code>git</code></li>
<li>e.g. restoring Python dependencies via <code>poetry</code></li>
<li>e.g. running the tests via <code>unittest</code></li>
<li>e.g. releasing the software via <code>poetry</code></li>
<li>e.g. doing some <em>automatic edit</em> to the repository (such as updating the version number), then <em>committing</em> and <em>pushing</em> the change <strong>automatically</strong></li>
</ul>
</li>
</ul>
</section><section>
<h2 id="github-actions-practical-example">GitHub Actions (practical example)</h2>
<p><img src="./actual-workflow.svg" alt=""></p>
<ul>
<li>Small rectangles represent <em>steps</em></li>
<li>Azure boxes represent <em>jobs</em></li>
<li>The whole is a <em>workflow</em></li>
</ul>
</section><section>
<h2 id="github-actions-configuration">GitHub Actions: Configuration</h2>
<ul>
<li>
<p>Workflows are configured in <a href="https://yaml.org/">YAML files</a> located in the <em>default branch</em> of the repository</p>
<ul>
<li>in the <code>.github/workflows/</code> folder.</li>
</ul>
</li>
<li>
<p>One configuration file $\Rightarrow$ one workflow</p>
</li>
<li>
<p>For security reasons,
workflows may need to get manually activated in the <em>Actions</em> tab of the GitHub web interface.</p>
<ul>
<li>on a per-repository basis</li>
</ul>
</li>
</ul>
</section><section>
<h2 id="github-actions-runners">GitHub Actions: Runners</h2>
<ul>
<li>Executors of GitHub actions are called <em>runners</em>
<ul>
<li>virtual machines (commonly hosted by GitHub)
<ul>
<li>with the GitHub Actions runner application installed.</li>
</ul>
</li>
</ul>
</li>
</ul>
<blockquote>
<p><strong>Note</strong>: the GitHub Actions application is open source and can be installed locally,
creating “<em>self-hosted runners</em>”. Self-hosted and GitHub-hosted runners can work together.</p></blockquote>
<ul>
<li>
<p>Upon their creation, runners have a default environment</p>
<ul>
<li>which depends on their <em>operating system</em></li>
</ul>
</li>
<li>
<p>Documentation available at <a href="https://docs.github.com/en/actions/using-github-hosted-runners/about-github-hosted-runners#preinstalled-software">https://docs.github.com/en/actions/using-github-hosted-runners/about-github-hosted-runners#preinstalled-software</a></p>
</li>
</ul>
</section><section>
<h2 id="convention-over-configuration">Convention over configuration</h2>
<p>Several CI systems inherit the “<em>convention over configuration</em>” principle.</p>
<blockquote>
<p>GitHub actions <strong>does not</strong> adhere to the principle:
if left unconfigured, the runner does nothing
(it does not even clone the repository locally).</p></blockquote>
<ul>
<li><strong>Probable reason</strong>: Actions is an <em>all-round</em> repository automation system for GitHub,
<ul>
<li>not just a “plain” CI/CD pipeline</li>
<li>$\Rightarrow$ it can react to many different events, not just changes to the git repository history</li>
</ul>
</li>
</ul>
</section><section>
<h2 id="gha-basic-workflow-structure">GHA: basic workflow structure</h2>
<p>Minimal, simplified workflow structure:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Mandatory workflow name</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Workflow Name</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">on</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Events that trigger the workflow</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">jobs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Jobs composing the workflow, each one will run on a different runner</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Job-Name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Every job must be named</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#8f5902;font-style:italic"># The type of runner executing the job, usually the OS</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">runs-on</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">runner-name</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">steps</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># A list of commands, or "actions"</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span>- <span style="color:#8f5902;font-style:italic"># first step</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span>- <span style="color:#8f5902;font-style:italic"># second step</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Another-Job</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># This one runs in parallel with Job-Name</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">runs-on</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">'...'</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">steps</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">... ]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div></section><section>
<h2 id="workflow-minimal-example">Workflow minimal example</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">CI/CD</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">on</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">push</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">branches</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">main ]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">jobs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">test</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">runs-on</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ubuntu-latest</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Test on Linux</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">timeout-minutes</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">45</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">steps</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Checkout code</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">uses</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">actions/checkout@v4</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Restore Python dependencies</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">run</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">poetry install</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Test</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">shell</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">bash</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">run</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">poetry run python -m unittest discover -v -s tests</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p><a href="https://github.com/unibo-dtm-se/calculator/blob/master/.github/workflows/check.yml">Consider <code>check.yml</code> file on the <code>calculator</code> repository</a> for a more complete example</p>
</section><section>
<h2 id="gha-steps-run-vs-uses">GHA Steps: <code>run</code> vs <code>uses</code></h2>
<ul>
<li>
<p><code>run</code>: run a command in the shell of the runner</p>
<ul>
<li>e.g. <code>run: poetry install</code></li>
<li>e.g. <code>run: python -m unittest discover -v -s tests</code></li>
</ul>
</li>
<li>
<p><code>uses</code>: run a <em>GitHub Actions’ <strong>action</strong></em></p>
<ul>
<li>e.g. <a href="https://github.com/actions/checkout"><code>actions/checkout@v4</code></a></li>
<li>e.g. <a href="https://github.com/actions/setup-python"><code>actions/setup-python@v5</code></a></li>
<li>e.g. <a href="https://github.com/actions/upload-artifact"><code>actions/upload-artifact@v3</code></a></li>
<li>e.g. <a href="https://github.com/actions/download-artifact"><code>actions/download-artifact@v3</code></a></li>
</ul>
</li>
</ul>
<h3 id="what-is-a-gha-action">What is a GHA action?</h3>
<ul>
<li>
<p>In the eyes of the GHA <strong>user</strong>: a <em>reusable</em> and <em>parametric</em> functionality which makes sense in the GHA ecosystem</p>
</li>
<li>
<p>In the eyes of the GHA <strong>developer</strong>: a <em>GitHub repository</em> the code to parametrise and reuse some functionality</p>
</li>
</ul>
</section><section>
<h2 id="checking-out-the-repository">Checking out the repository</h2>
<blockquote>
<p>By default, GitHub actions’ <em>runners do <strong>not</strong> clone the repository</em></p></blockquote>
<p>(this is because actions may, sometimes, not need to access the code, e.g., when automating issues, projects, etc.)</p>
<h3 id="cloning-and-checking-out-the-repository-is-done-via-a-dedicated-action">Cloning and checking out the repository is done via a dedicated action:</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Example workflow</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">on</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">push</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">branches</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">main ]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">jobs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">permissions</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">contents</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">write</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Give write (e.g. push) permissions to this Job (i.e. steps may perform changes to the repository it self)</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">Explore-GitHub-Actions</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Check out repository code</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">uses</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">actions/checkout@v4</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">with</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">fetch-depth</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Fetch all history for all branches and tags</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">token</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">${{ secrets.GITHUB_TOKEN }}</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Use the GITHUB_TOKEN secret to clone, enabling future pushes in next steps</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div>

<span class="fragment ">
  <p>By default, only the last commit of the current branch is fetched by this action (<em>shallow cloning</em> has better <em>performance</em>)</p>
<ul>
<li>$\Rightarrow$ It may break operations that rely on the entire history!
<ul>
<li>e.g., computing the next version number depending on the last tag in the Git history</li>
<li>use <code>fetch-depth: 0</code> to fetch the entire history</li>
</ul>
</li>
<li>If you plan to be able to push changes to the repository, you need to
<ul>
<li>provide a token with write permissions, e.g. <code>token: ${{ secrets.GITHUB_TOKEN }}</code>
<ul>
<li>secrets are explained a few slides later</li>
</ul>
</li>
<li>if you use the <code>GITHUB_TOKEN</code> secret, you need to set the <code>permissions</code> field to <code>write</code> for the <code>contents</code> permission
<ul>
<li>this is because the default permission for the <code>GITHUB_TOKEN</code> secret are read-only</li>
</ul>
</li>
</ul>
</li>
</ul>

</span>

</section><section>
<h2 id="writing-outputs">Writing outputs</h2>
<p>Communication with the runner happens via <em><a href="https://docs.github.com/en/actions/using-workflows/workflow-commands-for-github-actions">workflow commands</a></em>
<br>
The simplest way to create outputs for actions is to print on standard output a message in the form:
<br>
<code>"{name}={value}"</code>
<br>
and redirect it to the end of the file stored in the <code>$GITHUB_OUTPUT</code> environment variable:
<code>echo "{name}={value}" &gt;&gt; $GITHUB_OUTPUT</code></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Outputs</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">on</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># ...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">jobs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">Build</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">runs-on</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ubuntu-latest</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">steps</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">id</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">output-from-shell</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">run</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">python -c 'import random; print(f"dice={random.randint(1, 6)}")' &gt;&gt; $GITHUB_OUTPUT</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">run</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">|</span><span style="color:#8f5902;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">          echo "The dice roll resulted in number ${{ steps.output-from-shell.outputs.dice }}"</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div></section><section>
<h2 id="build-matrix">Build matrix</h2>
<p>Most software products are meant to be <em>portable</em></p>
<ul>
<li>Across operating systems</li>
<li>Across different frameworks and languages</li>
<li>Across runtime configuration</li>
</ul>
<p>A good continuous integration pipeline should test <em>all the supported combinations</em>*</p>
<ul>
<li>or a sample, if the performance is otherwise unbearable</li>
</ul>
<p>The solution is the adoption of a <strong>build matrix</strong></p>
<ul>
<li>Build variables and their allowed values are specified</li>
<li>The CI integrator generates the <em>cartesian product</em> of the variable values, and launches a build for each!</li>
<li>Note: there is no built-in feature to exclude some combination
<ul>
<li>It must be done manually using <code>if</code> conditionals</li>
</ul>
</li>
</ul>
</section><section>
<h2 id="build-matrix-in-gha">Build matrix in GHA</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Workflow with Matrix</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">on</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># ...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">jobs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">test</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">strategy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">fail-fast</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">false</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">matrix</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">os</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- <span style="color:#000">ubuntu-latest</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- <span style="color:#000">windows-latest</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- <span style="color:#000">macos-latest</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">python-version</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- <span style="color:#4e9a06">'3.10'</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- <span style="color:#4e9a06">'3.11'</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span>- <span style="color:#4e9a06">'3.12'</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">runs-on</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">${{ matrix.os }}</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Test on Python ${{ matrix.python-version }}, on ${{ matrix.os }}</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">timeout-minutes</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">45</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">steps</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Setup Python</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">uses</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">actions/setup-python@v5</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">with</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">python-version</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">${{ matrix.python-version }}</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Install poetry</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">run</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">pip install poetry</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Checkout code</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">uses</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">actions/checkout@v4</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Restore Python dependencies</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">run</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">poetry install</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Test</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">shell</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">bash</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">run</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">poetry run python -m unittest discover -v -s tests</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div></section><section>
<h2 id="private-data-and-continuous-integration">Private data and continuous integration</h2>
<p>We would like the CI to be able to</p>
<ul>
<li>Sign our artifacts</li>
<li>Delivery/Deploy our artifacts on remote targets</li>
</ul>
<p>Both operations <strong>require private information to be shared</strong></p>
<p>Of course, private data <em>can’t be shared</em></p>
<ul>
<li>Attackers may steal the identity</li>
<li>Attackers may compromise deployments</li>
<li>In case of open projects, attackers may exploit <em>pull requests</em>!
<ul>
<li>Fork your project (which has e.g. a secret environment variable)</li>
<li>Print the value of the secret (e.g. with <code>printenv</code>)</li>
</ul>
</li>
</ul>
<p>How to <em>share a secret</em> with the build environment?</p>
</section><section>
<h2 id="secrets">Secrets</h2>
<p>Secrets can be stored in GitHub at the repository or organization level.</p>
<p>GitHub Actions can access these secrets from the context:</p>
<ul>
<li>Using the <code>secrets.&lt;secret name&gt;</code> context object</li>
<li>Access is allowed only for workflows generated by local events
<ul>
<li>Namely, no secrets for pull requests</li>
</ul>
</li>
</ul>
<p>Secrets can be added from the web interface (for mice lovers), or via the GitHub CLI:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span>gh secret <span style="color:#204a87">set</span> TEST_PYPI_TOKEN -b <span style="color:#4e9a06">"dhhfuidhfiudhfidnalnflkanjakl"</span>
</span></span></code></pre></div></section><section>
<h1 id="stale-builds">Stale builds</h1>
<ol>
<li>Stuff <em>works</em></li>
<li><em>Nobody touches it</em> for months</li>
<li>Untouched stuff is now <em>borked</em>!</li>
</ol>
<br>
<ul>
<li>Connected to the issue of <strong>build reproducibility</strong>
<ul>
<li>The higher the build <em>reproducibility</em>, the higher its <em>robustness</em></li>
</ul>
</li>
<li>The default runner configuration may change</li>
<li>Some tools may become unavailable</li>
<li>Some dependencies may get unavailable</li>
</ul>
<p><strong>The sooner the issue is known, the better</strong></p>
<p>$\Rightarrow$ <em>Automatically run the build every some time</em> even if nobody touches the project</p>
<ul>
<li>How often? Depends on the project…</li>
<li><strong>Warning</strong>: GitHub Actions disables <code>cron</code> CI jobs if there is no action on the repository, which makes the mechanism less useful</li>
</ul>
</section><section>
<h2 id="additional-checks-and-reportings">Additional checks and reportings</h2>
<p>There exist a number of recommended services that provide additional QA and reports.</p>
<p>Non exhaustive list:</p>
<ul>
<li><a href="https://codecov.io/">Codecov.io</a>
<ul>
<li>Code coverage</li>
<li>Supports Jacoco XML reports</li>
<li>Nice data reporting system</li>
</ul>
</li>
<li><a href="https://sonarcloud.io/">Sonarcloud</a>
<ul>
<li>Multiple measures, covering reliability, security, maintainability, duplication, complexity…</li>
</ul>
</li>
<li><a href="https://www.codacy.com/">Codacy</a>
<ul>
<li>Automated software QA for several languages</li>
</ul>
</li>
<li><a href="https://www.codefactor.io/">Code Factor</a>
<ul>
<li>Automated software QA</li>
</ul>
</li>
</ul>
</section><section>
<h2 id="high-quality-floss-checklist">High quality FLOSS checklist</h2>
<p>The <a href="https://www.linuxfoundation.org/">Linux Foundation</a> <a href="https://www.coreinfrastructure.org/">Core Infrastructure Initiative</a> created a checklist for high quality FLOSS.</p>
<p><strong><a href="https://bestpractices.coreinfrastructure.org/en">CII Best Practices Badge Program https://bestpractices.coreinfrastructure.org/en</a></strong></p>
<ul>
<li><em>Self-certification</em>: no need for bureaucracy</li>
<li>Provides a nice <em>TODO list</em> for a high quality product</li>
<li>Releases a <em>badge</em> that can be added e.g. to the project homepage</li>
</ul>
</section><section>
<h2 id="automated-evolution">Automated evolution</h2>
<p>A full-fledged CI system allows reasonably safe <em>automated evolution of software</em>
<br>
At least, in terms of <em>dependency updates</em></p>
<p>Assuming that you can <em>effectively intercept issues</em>,
here is a possible workflow for <strong>automatic</strong> dependency updates:</p>
<ol>
<li><em>Check</em> if there are new updates</li>
<li><em>Apply</em> the update in a new branch</li>
<li><em>Open</em> a pull request</li>
<li><em>Verify</em> if changes break anything
<ul>
<li>If they do, manual intervention is required</li>
</ul>
</li>
<li><em>Merge</em></li>
</ol>
</section><section>
<h2 id="automated-evolution-1">Automated evolution</h2>
<p><strong>Bots</strong> performing the aforementioned process for a variety of build systems exist.</p>
<p>They are usually integrated with the repository hosting provider</p>
<ul>
<li>Whitesource Renovate (Multiple)
<ul>
<li>Also updates github actions and Gradle Catalogs</li>
</ul>
</li>
<li>Dependabot (Multiple)</li>
<li>Gemnasium (Ruby)</li>
<li>Greenkeeper (NPM)</li>
</ul>
</section><section>


<section data-shortcode-section="">
<h2 id="check-your-understanding-pt-1">Check your understanding (pt. 1)</h2>
<ul>
<li>In your own words, what is continuous integration?</li>
<li>In your own words, what is integration hell?</li>
<li>In the context of continuous integration, what is a pipeline?</li>
<li>What is GitHub Actions?</li>
<li>In the context of continuous integration, provide an overview of the abstract pipeline design</li>
<li>In the context of GitHub Actions, what is the difference among workflow, jobs, steps</li>
<li>How would you design a GitHub Actions workflow for a Python project?</li>
<li>In the context of GitHub Actions, what is a runner?</li>
<li>What is YAML? What is the difference between YAML and JSON?</li>
<li>In the context of GitHub Actions, what is a matrix?</li>
<li>In the context of GitHub Actions, what is a secret?</li>
</ul>
</section><section>
<h2 id="check-your-understanding-pt-2">Check your understanding (pt. 2)</h2>
<ul>
<li>In the context of software engineering, what is integration? What is continuous integration?</li>
<li>In the context of software engineering, what are the issues arising from infrequent integration/release events?</li>
<li>In the context of software engineering, how to make integration continuous?</li>
<li>What is GitHub Actions? What is its purpose? How does it work?</li>
<li>In the context of GitHub Actions, what is the difference among workflow, jobs, steps</li>
<li>In an ordinary Python project using Poetry for build automation and release on PyPi and <code>unittest</code> for automatic tests, how would you organize a continuous integration pipeline? (What operations should be performed in each run of the pipeline?)</li>
</ul>

</section>
</section><section>
<h1 id="lecture-is-over">Lecture is Over</h1>
<br>
<p>Compiled on: 2025-06-17 — <a href="?print-pdf&amp;pdfSeparateFragments=false"><i class="fa fa-print" aria-hidden="true"></i> printable version</a></p>
<p><a href="../#/toc"><i class="fa fa-undo" aria-hidden="true"></i> back to ToC</a></p>
</section>

  


</div>
      

    </div>
<script type="text/javascript" src="/course-slides/reveal-hugo/object-assign.js"></script>

<a href="/course-slides/reveal-js/dist/print/" id="print-location" style="display: none;"></a>

<script type="application/json" id="reveal-hugo-site-params">{"custom_theme":"custom-theme.scss","custom_theme_compile":true,"custom_theme_options":{"enablesourcemap":true,"targetpath":"css/custom-theme.css"},"height":"1080","highlight_theme":"github","history":true,"mermaid":[{"gitGraph":{"mainBranchName":"master","rotateCommitLabel":true},"startOnLoad":false,"useMaxWidth":false}],"slide_number":true,"theme":"league","transition":"slide","transition_speed":"fast","width":"1920"}</script>
<script type="application/json" id="reveal-hugo-page-params">null</script>

<script src="/course-slides/reveal-js/dist/reveal.js"></script>


  
  
  <script type="text/javascript" src="/course-slides/reveal-js/plugin/markdown/markdown.js"></script>
  
  <script type="text/javascript" src="/course-slides/reveal-js/plugin/highlight/highlight.js"></script>
  
  <script type="text/javascript" src="/course-slides/reveal-js/plugin/zoom/zoom.js"></script>
  
  <script type="text/javascript" src="/course-slides/reveal-js/plugin/notes/notes.js"></script>
  
  
  <script type="text/javascript" src="/course-slides/reveal-js/plugin/notes/notes.js"></script>




<script type="text/javascript">
  
  
  function camelize(map) {
    if (map) {
      Object.keys(map).forEach(function(k) {
        newK = k.replace(/(\_\w)/g, function(m) { return m[1].toUpperCase() });
        if (newK != k) {
          map[newK] = map[k];
          delete map[k];
        }
      });
    }
    return map;
  }

  var revealHugoDefaults = { center: true, controls: true, history: true, progress: true, transition: "slide" };

  var revealHugoPlugins = {
    plugins: [ RevealMarkdown, RevealHighlight, RevealNotes, RevealZoom ]
   };
  var revealHugoSiteParams = JSON.parse(document.getElementById('reveal-hugo-site-params').innerHTML);
  var revealHugoPageParams = JSON.parse(document.getElementById('reveal-hugo-page-params').innerHTML);
  
  var options = Object.assign({},
    camelize(revealHugoDefaults),
    camelize(revealHugoSiteParams),
    camelize(revealHugoPageParams),
    camelize(revealHugoPlugins));
  Reveal.initialize(options);
</script>







  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  





    <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      },
      svg: {
        fontCache: 'global'
      }
    };
</script>

<script type="text/javascript" id="MathJax-script" async="" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>

<script>
  if (/.*?(\?|&)print-pdf/.test(window.location.toString())) {
      var ytVideos = document.getElementsByTagName("iframe")
      for (let i = 0; i < ytVideos.length; i++) {
          var videoFrame = ytVideos[i]
          var isYouTube = /^https?:\/\/(www.)youtube\.com\/.*/.test(videoFrame.src)
          if (isYouTube) {
              console.log(`Removing ${videoFrame.src}`)
              var parent = videoFrame.parentElement
              videoFrame.remove()
              var p = document.createElement('p')
              p.append(
                  document.createTextNode(
                      "There was an embedded video here, but it is disabled in the printed version of the slides."
                  )
              )
              p.append(document.createElement('br'))
              p.append(
                  document.createTextNode(
                      `Visit instead ${
                          videoFrame.src
                      } or ${
                          videoFrame.src.replace(
                              /(^https?:\/\/(www.)youtube\.com)\/(embed\/)(\w+).*/,
                              "https://www.youtube.com/watch?v=$4"
                          )
                      }`
                  )
              )
              parent.appendChild(p)
          }
      }
  }
</script>


    
  

</body></html>