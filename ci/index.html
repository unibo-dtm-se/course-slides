<!DOCTYPE html><html lang="en"><head>
    <meta charset="utf-8">
<title>Software Engineering Module 3: Continuous Integration</title>
<meta name="description" content="Make things work, keep them working, move fast">
<meta name="author" content="Danilo Pianini">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><link rel="stylesheet" href="/course-slides/reveal-js/dist/reset.css">
<link rel="stylesheet" href="/course-slides/reveal-js/dist/reveal.css">
  <link rel="stylesheet" href="/course-slides/css/custom-theme.min.e98e7d09f955f316ccf66388b4c5eb8b89dfdb0a57cb72bf0fc9f3f33860984c.css" id="theme"><link rel="stylesheet" href="/course-slides/highlight-js/github.min.css">
<link rel="stylesheet" href="https://raw.githubusercontent.com/DanySK/css-blur-animation/master/blur.css">
<link href="https://fonts.googleapis.com/css?family=Roboto Mono" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Oxygen Mono" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Ubuntu Mono" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
<script src="https://kit.fontawesome.com/81ac037be0.js" crossorigin="anonymous"></script>

  </head>
  <body>
    
    <div class="reveal">
      <div class="slides">
  

    <section><h1 id="hahahugoshortcode3s0hbhb">Software Engineering</h1>
<h2 id="continuous-integration-and-containerization">Continuous Integration and Containerization</h2>
<h3 id="danilo-pianinimailtodanilopianiniuniboit"><a href="mailto:danilo.pianini@unibo.it">Danilo Pianini</a></h3>
2024-02-12
</section><section>
<h1 id="continuous-integration">Continuous Integration</h1>
<p>The practice of integrating code with a main development line <strong>continuously</strong>
<br>
<em>Verifying</em> that the build remains intact</p>
<ul>
<li>Requires <em>build automation</em> to be in place</li>
<li>Requires <em>testing</em> to be in place</li>
<li>Pivot point of the <em>DevOps</em> practices</li>
<li>Historically introduced by the extreme programming (XP) community</li>
<li>Now widespread in the larger DevOps community</li>
</ul>
</section><section>
<h1 id="the-integration-hell">The Integration Hell</h1>
<ul>
<li>Traditional software development takes several months for <em>“integrating”</em> a couple of years of development</li>
<li>The longer there is no integrated project, the higher the <strong>risk</strong></li>
</ul>
<img src="integration-traditional.png" onerror="this.onerror=null; this.src='../../assets/integration-traditional.png'" width="40%">
$\Rightarrow$
<img src="integration-continuous.png" onerror="this.onerror=null; this.src='../../assets/integration-continuous.png'" width="40%">
</section><section>
<h2 id="microreleases-and-protoduction">Microreleases and protoduction</h2>
<ul>
<li>High frequency integration may lead to high frequency releases
<ul>
<li>Possibly, <em>one per commit</em></li>
<li>Of course, <em>versioning</em> must be appropriate…</li>
</ul>
</li>
</ul>
<p>Traditionally, <strong>protoduction</strong> is jargon for a <em>prototype that ends up in production</em></p>
<table>
  <tbody>
    <tr>
      <td>
        <img src="protoduction.jpg" onerror="this.onerror=null; this.src='../../assets/protoduction.jpg'" width="90%">
      </td><td>
      </td><td>
<ul>
<li>Traditionally used with a <em>negative</em> meaning
<ul>
<li>It implied software
<ul>
<li><em>unfinished</em>,</li>
<li><em>unpolished</em>,</li>
<li><em>badly designed</em></li>
</ul>
</li>
<li>Very common, unfortunately</li>
</ul>
</li>
<li>This si different in a continuously integrated environment
<ul>
<li>
<p><em>Incrementality</em> is fostered</p>
</li>
<li>
<p>Partial features are <em>up to date</em> with the mainline</p>
</li></ul></li></ul></td><td>


  </td></tr>
</tbody>


</table>
</section><section>
<h2 id="intensive-operations-should-be-elsewhere">Intensive operations should be elsewhere</h2>
<ul>
<li>The build process should be <em>rich</em> and <em>fast</em></li>
<li>Operations requiring a long time should be <em>automated</em>
<ul>
<li>And run somewhere else than devs’ PCs</li>
</ul>
</li>
</ul>
<p>
<img src="compiling.png" onerror="this.onerror=null; this.src='../../assets/compiling.png'" height="100%">
</p>
</section><section>
<h2 id="continuous-integration-software">Continuous integration software</h2>
<p>Software that promotes CI practices should:</p>
<ul>
<li>Provide <em>clean environments</em> for compilation/testing</li>
<li>Provide a <em>wide range</em> of environments
<ul>
<li>Matching the relevant specifications of the actual targets</li>
</ul>
</li>
<li>High degree of <em>configurability</em></li>
<li>Possibly, <em>declarative configuration</em></li>
<li>A <em>notification system</em> to alert about failures or issues</li>
<li>Support for <em>authentication</em> and deployment to external services</li>
</ul>
<p><strong>Plenty</strong> of integrators on the market</p>
<p>Circle CI, Travis CI, Werker, done.io, Codefresh, Codeship, Bitbucket Pipelines, GitHub Actions, GitLab CI/CD Pipelines, JetBrains TeamCity…</p>
<p>We will use GitHub actions: GitHub integration, free for FOSS, multi-os OSs supported</p>
</section><section>
<h1 id="core-concepts">Core concepts</h1>
<p>Naming and organization is variable across platforms, but <em>in general</em>:</p>
<ul>
<li>One or more <strong>pipelines</strong> can be associated to <strong>events</strong>
<ul>
<li>For instance, a <em>new commit</em>, an update to a <em>pull request</em>, or a <em>timeout</em></li>
</ul>
</li>
<li>Every pipeline is composed of a <strong>sequence</strong> of <strong>operations</strong></li>
<li>Every <strong>operation</strong> could be composed of sequential or parallel <strong>sub-operations</strong></li>
<li>How many hierarchical levels are available depends on the specific platform
<ul>
<li>GitHub Actions: <em>workflow</em> $\Rightarrow$ <em>job</em> $\Rightarrow$ <em>step</em></li>
<li>Travis CI: <em>build</em> $\Rightarrow$ <em>stage</em> $\Rightarrow$ <em>job</em>  $\Rightarrow$ <em>phase</em></li>
</ul>
</li>
<li>Execution happens in a <strong>fresh system</strong> (virtual machine or container)
<ul>
<li>Often containers inside virtual machines</li>
<li>The specific point of the hierarchy at which the VM/container is spawned depends on the CI platform</li>
</ul>
</li>
</ul>
</section><section>
<h2 id="pipeline-design">Pipeline design</h2>
<p>In essence, designing a CI system is designing a software construction, verification, and delivery <em>pipeline</em>
with the abstractions provided by the selected provider.</p>
<ol>
<li><strong>Think</strong> of all the operations required starting from one or more <em>blank</em> VMs
<ul>
<li>OS configuration</li>
<li>Software installation</li>
<li>Project checkout</li>
<li>Compilation</li>
<li>Testing</li>
<li>Secrets configuration</li>
<li>Delivery</li>
<li>…</li>
</ul>
</li>
<li><strong>Organize</strong> them in a dependency graph</li>
<li><strong>Model</strong> the graph with the provided CI tooling</li>
</ol>
<p>Configuration can grow complex, and is usually stored in a YAML file
<br>
(but there are exceptions, JetBrains TeamCity uses a Kotlin DSL).</p>
</section><section>
<h2 id="github-actions-structure">GitHub Actions: Structure</h2>
<ul>
<li><strong>Workflows</strong> react to events, launching <em>jobs</em>
<ul>
<li>Multiple workflows run in parallel, unless explicitly restricted</li>
</ul>
</li>
<li><strong>Jobs</strong> of the same workflow run a sequence of <em>steps</em>
<ul>
<li>Multiple jobs run in parallel, unless a dependency among them is explicitly declared</li>
<li>Concurrency limits can be imposed across workflows</li>
<li>They can communicate via outputs</li>
</ul>
</li>
<li><strong>Steps</strong> of the same job run <em>sequentially</em>
<ul>
<li>They can communicate via outputs</li>
</ul>
</li>
</ul>
</section><section>
<h2 id="github-actions-configuration">GitHub Actions: Configuration</h2>
<p>Workflows are configured in YAML files located in the default branch of the repository in the <code>.github/workflows</code> folder.</p>
<p>One configuration file $\Rightarrow$ one workflow</p>
<p>For security reasons,
workflows may need to get manually activated in the <em>Actions</em> tab of the GitHub web interface.</p>
</section><section>
<h2 id="github-actions-runners">GitHub Actions: Runners</h2>
<p>Executors of GitHub actions are called <em>runners</em>: virtual machines
(hosted by GitHub)
with the GitHub Actions runner application installed.</p>
<p><strong>Note</strong>: the GitHub Actions application is open source and can be installed locally,
creating “<em>self-hosted runners</em>”. Self-hosted and GitHub-hosted runners can work together.</p>
<p>Upon their creation, runners have a default environment, which depends on their <em>operating system</em></p>
<ul>
<li>Documentation available at <a href="https://docs.github.com/en/actions/using-github-hosted-runners/about-github-hosted-runners#preinstalled-software">https://docs.github.com/en/actions/using-github-hosted-runners/about-github-hosted-runners#preinstalled-software</a></li>
</ul>
</section><section>
<h2 id="convention-over-configuration">Convention over configuration</h2>
<p>Several CI systems inherit the “<em>convention over configuration</em>” principle.</p>
<p>For instance, by default (with an empty configuration file) Travis CI builds a Ruby project using <code>rake</code>.</p>
<p>GitHub actions <strong>does not</strong> adhere to the principle:
if left unconfigured, the runner does nothing
(it does not even clone the repository locally).</p>
<p>Probable reason: Actions is an <em>all-round</em> repository automation system for GitHub,
not just a “plain” CI/CD pipeline</p>
<p>$\Rightarrow$ It can react to many different events, not just changes to the git repository history</p>
</section><section>
<h2 id="gha-basic-workflow-structure">GHA: basic workflow structure</h2>
<p>Minimal, simplified workflow structure:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Mandatory workflow name</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Workflow Name</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">on</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Events that trigger the workflow</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">jobs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Jobs composing the workflow, each one will run on a different runner</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Job-Name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Every job must be named</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#8f5902;font-style:italic"># The type of runner executing the job, usually the OS</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">runs-on</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">runner-name</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">steps</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># A list of commands, or "actions"</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span>- <span style="color:#8f5902;font-style:italic"># first step</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">            </span>- <span style="color:#8f5902;font-style:italic"># second step</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">Another-Job</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># This one runs in parallel with Job-Name</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">runs-on</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">'...'</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">steps</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">... ]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div></section><section>
<h3 id="dry-with-yaml">DRY with YAML</h3>
<p>We discussed that automation / integration pipelines <strong>are</strong> part of the software</p>
<ul>
<li>They are subject to the same (or even higher) quality standards</li>
<li>All the good engineering principles apply!</li>
</ul>
<p>YAML is often used by CI integrators as preferred configuration language as it enables some form of DRY:</p>
<ol>
<li>Anchors (<code>&amp;</code> / <code>*</code>)</li>
<li>Merge keys (<code>&lt;&lt;:</code>)</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">hey</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic">&amp;ref</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">look</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">at</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">me</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">"I'm"</span><span style="color:#000;font-weight:bold">,</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">'dancing'</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">merged</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">foo</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic">*ref</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">&lt;&lt;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic">*ref</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">look</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">to</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>Same as:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">hey</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">look: at, me</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">"I'm"</span><span style="color:#000;font-weight:bold">,</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">'dancing'</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">]</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">merged</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">foo</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{<span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">look: at, me</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">"I'm"</span><span style="color:#204a87;font-weight:bold">, 'dancing' ] }, look: to, me</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">"I'm"</span><span style="color:#000;font-weight:bold">,</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">'dancing'</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">]</span><span style="color:#f8f8f8;text-decoration:underline"> </span>}<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div></section><section>
<h2 id="github-actions-actions">GitHub Actions’ actions</h2>
<p>GHA’s YAML parser <em>does not support standard YAML anchors and merge keys</em></p>
<p>(it is a well-known limit with <a href="https://github.com/actions/runner/issues/1182">an issue report open since ages</a>)</p>
<p>GHA achieves reuse via:</p>
<ul>
<li>“<strong>actions</strong>”: <em>reusable parameterizable <strong>steps</strong></em>
<ul>
<li><em>JavaScript</em> (working on any OS)</li>
<li><em>Docker container</em>-based (linux only)</li>
<li><em>Composite</em> (assemblage of other actions)</li>
</ul>
</li>
<li>“<strong>reusable workflows</strong>”: <em>reusable and parameterizable <strong>jobs</strong></em></li>
</ul>
<p>Many actions are provided by GitHub directly,
and many are developed by the community.</p>
</section><section>
<h2 id="workflow-minimal-example">Workflow minimal example</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># This is a basic workflow to help you get started with Actions</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Example workflow</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#8f5902;font-style:italic"># Controls when the workflow will run</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">on</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">push</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">tags</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">'*'</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">branches-ignore</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Pushes on these branches won't start a build</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#4e9a06">'autodelivery**'</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#4e9a06">'bump-**'</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#4e9a06">'renovate/**'</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">paths-ignore</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Pushes that change only these file won't start the workflow</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#4e9a06">'README.md'</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#4e9a06">'CHANGELOG.md'</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#4e9a06">'LICENSE'</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">pull_request</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">branches</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Only pull requests based on these branches will start the workflow</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#000">master</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># Allows you to run this workflow manually from the Actions tab</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">workflow_dispatch:</span></span></span></code></pre></div>
</section><section>
<h2 id="workflow-minimal-example-1">Workflow minimal example</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># A workflow run is made up of one or more jobs that can run sequentially or in parallel</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">jobs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#8f5902;font-style:italic"># This workflow contains a single job called "build"</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">Default-Example</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># The type of runner that the job will run on</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">runs-on</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">macos-latest</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># Steps represent a sequence of tasks that will be executed as part of the job</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">steps</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">uses</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># Runs a single command using the runners shell</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Run a one-line script</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">run</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">echo Hello from a ${{ runner.os }} machine!</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># Runs a set of commands using the runners shell</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Run a multi-line script</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">run</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">|</span><span style="color:#8f5902;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">          echo Add other actions to build,
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">          echo test, and deploy your project.</span><span style="color:#f8f8f8;text-decoration:underline">          </span></span></span></code></pre></div>
</section><section>
<h2 id="workflow-minimal-example-2">Workflow minimal example</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">Explore-GitHub-Actions</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">runs-on</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ubuntu-latest</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">steps</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">run</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">echo "🎉 The job was automatically triggered by a ${{ github.event_name }} event."</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">run</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">echo "🐧 This job is now running on a ${{ runner.os }} server hosted by GitHub!"</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">run</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">echo "🔎 The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}."</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Check out repository code</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">uses</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">actions/checkout@v4</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">run</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">echo "💡 The ${{ github.repository }} repository has been cloned to the runner."</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">run</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">echo "🖥️ The workflow is now ready to test your code on the runner."</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">List files in the repository</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">run</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ls ${{ github.workspace }}</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">run</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">echo "🍏 This job's status is ${{ job.status }}."</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#8f5902;font-style:italic"># Steps can be executed conditionally</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Skipped conditional step</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">if</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">runner.os == 'Windows'</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">run</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">echo this step won't run, it has been excluded!</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">run</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">|</span><span style="color:#8f5902;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">          echo This is
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">          echo a multi-line
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">          echo script.</span><span style="color:#f8f8f8;text-decoration:underline">          </span></span></span></code></pre></div>
</section><section>
<h2 id="workflow-minimal-example-3">Workflow minimal example</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">Conclusion</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">runs-on</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">windows-latest</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># Jobs may require other jobs</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">needs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Default-Example, Explore-GitHub-Actions ]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># Typically, steps that follow failed steps won't execute.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#8f5902;font-style:italic"># However, this behavior can be changed by using the built-in function "always()"</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">if</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">always()</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">steps</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Run something on powershell</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">run</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">echo By default, ${{ runner.os }} runners execute with powershell</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Run something on bash</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">shell</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">bash</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">run</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">echo However, it is allowed to force the shell type and there is a bash available for ${{ runner.os }} too.</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      
</span></span></span></code></pre></div>
</section><section>
<h2 id="checking-out-the-repository">Checking out the repository</h2>
<p>By default, GitHub actions’ <em>runners do <strong>not</strong> check out the repository</em></p>
<ul>
<li>Actions may not need to access the code
<ul>
<li>e.g., Actions automating issues, projects</li>
</ul>
</li>
</ul>
<p>It is a <em>common</em> and <em>non-trivial</em> operation (the checked out version must be the version originating the workflow), thus GitHub provides an action:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Check out repository code</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">uses</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">actions/checkout@v4</span></span></span></code></pre></div>
<p>Since actions typically do not need the entire history of the project, by default the action checks out <em>only the commit that originated the workflow</em> (<code>--depth=1</code> when cloning)</p>
<ul>
<li><em>Shallow cloning</em> has better <em>performance</em></li>
<li>$\Rightarrow$ It may break operations that rely on the entire history!
<ul>
<li>e.g., the git-sensitive semantic versioning system</li>
</ul>
</li>
</ul>
<p>Also, <em><strong>tags</strong> don’t get checked out</em></p>
</section><section>
<h2 id="writing-outputs">Writing outputs</h2>
<p>Communication with the runner happens via <em><a href="https://docs.github.com/en/actions/using-workflows/workflow-commands-for-github-actions">workflow commands</a></em>
<br>
The simplest way to create outputs for actions is to print on standard output a message in the form:
<br>
<code>"{name}={value}"</code>
<br>
and redirect it to the end of the file stored in the <code>$GITHUB_OUTPUT</code> environment variable:
<code>echo "{name}={value}" &gt;&gt; $GITHUB_OUTPUT</code></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">jobs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">Build</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">runs-on</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ubuntu-latest</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">steps</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">Checkout</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">uses</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">danysk/action-checkout@0.2.14</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">id</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">branch-name</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Custom id</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">uses</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">tj-actions/branch-names@v8</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">id</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">output-from-shell</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">run</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ruby -e 'puts "dice=#{rand(1..6)}"' &gt;&gt; $GITHUB_OUTPUT</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">run</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">|</span><span style="color:#8f5902;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">          echo "The dice roll resulted in number ${{ steps.output-from-shell.outputs.dice }}"
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">          if ${{ steps.branch-name.outputs.is_tag }} ; then
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">            echo "This is tag ${{ steps.branch-name.outputs.tag }}"
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">          else
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">            echo "This is branch ${{ steps.branch-name.outputs.current_branch }}"
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">            echo "Is this branch the default one? ${{ steps.branch-name.outputs.is_default }}"
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">          fi</span><span style="color:#f8f8f8;text-decoration:underline">          
</span></span></span></code></pre></div>
</section><section>
<h2 id="build-matrix">Build matrix</h2>
<p>Most software products are meant to be <em>portable</em></p>
<ul>
<li>Across operating systems</li>
<li>Across different frameworks and languages</li>
<li>Across runtime configuration</li>
</ul>
<p>A good continuous integration pipeline should test <em>all the supported combinations</em>*</p>
<ul>
<li>or a sample, if the performance is otherwise unbearable</li>
</ul>
<p>The solution is the adoption of a <strong>build matrix</strong></p>
<ul>
<li>Build variables and their allowed values are specified</li>
<li>The CI integrator generates the <em>cartesian product</em> of the variable values, and launches a build for each!</li>
<li>Note: there is no built-in feature to exclude some combination
<ul>
<li>It must be done manually using <code>if</code> conditionals</li>
</ul>
</li>
</ul>
</section><section>
<h2 id="build-matrix-in-gha">Build matrix in GHA</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">jobs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">Build</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">strategy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">matrix</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">os</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#000">windows, macos, ubuntu]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">jvm_version</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">8</span><span style="color:#000;font-weight:bold">,</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">11</span><span style="color:#000;font-weight:bold">,</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">15</span><span style="color:#000;font-weight:bold">,</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">16</span><span style="color:#000;font-weight:bold">]</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># Arbitrarily-made and arbitrarily-valued variables</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">ruby_version</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">2.7</span><span style="color:#000;font-weight:bold">,</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">3.0</span><span style="color:#000;font-weight:bold">]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">python_version</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[</span><span style="color:#0000cf;font-weight:bold">3.7</span><span style="color:#000;font-weight:bold">,</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">3.9.12</span><span style="color:#000;font-weight:bold">]</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">runs-on</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">${{ matrix.os }}-latest</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic">## The string is computed interpolating a variable value</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">steps</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">uses</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">actions/setup-java@v4</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">with</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">distribution</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">'adopt'</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">java-version</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">${{ matrix.jvm_version }}</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># "${{ }}" contents are interpreted by the github actions runner</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">uses</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">actions/setup-python@v5</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">with</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">python-version</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">${{ matrix.python_version }} </span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">uses</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ruby/setup-ruby@v1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">with</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">ruby-version</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">${{ matrix.ruby_version }}</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">shell</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">bash</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">run</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">java -version</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">shell</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">bash</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">run</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ruby --version</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">shell</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">bash</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">run</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">python --version</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div>
</section><section>
<h2 id="private-data-and-continuous-integration">Private data and continuous integration</h2>
<p>We would like the CI to be able to</p>
<ul>
<li>Sign our artifacts</li>
<li>Delivery/Deploy our artifacts on remote targets</li>
</ul>
<p>Both operations <strong>require private information to be shared</strong></p>
<p>Of course, private data <em>can’t be shared</em></p>
<ul>
<li>Attackers may steal the identity</li>
<li>Attackers may compromise deployments</li>
<li>In case of open projects, attackers may exploit <em>pull requests</em>!
<ul>
<li>Fork your project (which has e.g. a secret environment variable)</li>
<li>Print the value of the secret (e.g. with <code>printenv</code>)</li>
</ul>
</li>
</ul>
<p>How to <em>share a secret</em> with the build environment?</p>
</section><section>
<h2 id="secrets">Secrets</h2>
<p>Secrets can be stored in GitHub at the repository or organization level.</p>
<p>GitHub Actions can access these secrets from the context:</p>
<ul>
<li>Using the <code>secrets.&lt;secret name&gt;</code> context object</li>
<li>Access is allowed only for workflows generated by local events
<ul>
<li>Namely, no secrets for pull requests</li>
</ul>
</li>
</ul>
<p>Secrets can be added from the web interface (for mice lovers), or via the GitHub API.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#!/usr/bin/env ruby</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">require</span> <span style="color:#4e9a06">'rubygems'</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">require</span> <span style="color:#4e9a06">'bundler/setup'</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">require</span> <span style="color:#4e9a06">'octokit'</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">require</span> <span style="color:#4e9a06">'rbnacl'</span>
</span></span><span style="display:flex;"><span><span style="color:#000">repo_slug</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87">name</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">ARGV</span>
</span></span><span style="display:flex;"><span><span style="color:#000">client</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Octokit</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">Client</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">new</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">:access_token</span> <span style="color:#ce5c00;font-weight:bold">=&gt;</span> <span style="color:#4e9a06">'access_token_from_github'</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">pubkey</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">client</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">get_public_key</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">repo_slug</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">key</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Base64</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">decode64</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">pubkey</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">key</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">sodium_box</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">RbNaCl</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">Boxes</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">Sealed</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">from_public_key</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">key</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">encrypted_value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Base64</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">strict_encode64</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">sodium_box</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">encrypt</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">value</span><span style="color:#000;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span><span style="color:#000">payload</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#4e9a06">'key_id'</span> <span style="color:#ce5c00;font-weight:bold">=&gt;</span> <span style="color:#000">pubkey</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">key_id</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">'encrypted_value'</span> <span style="color:#ce5c00;font-weight:bold">=&gt;</span> <span style="color:#000">encrypted_value</span> <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000">client</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">create_or_update_secret</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">repo_slug</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87">name</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">payload</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div></section><section>
<h1 id="stale-builds">Stale builds</h1>
<ol>
<li>Stuff <em>works</em></li>
<li><em>Nobody touches it</em> for months</li>
<li>Untouched stuff is now <em>borked</em>!</li>
</ol>
<br>
<ul>
<li>Connected to the issue of <strong>build reproducibility</strong>
<ul>
<li>The higher the build <em>reproducibility</em>, the higher its <em>robustness</em></li>
</ul>
</li>
<li>The default runner configuration may change</li>
<li>Some tools may become unavailable</li>
<li>Some dependencies may get unavailable</li>
</ul>
<p><strong>The sooner the issue is known, the better</strong></p>
<p>$\Rightarrow$ <em>Automatically run the build every some time</em> even if nobody touches the project</p>
<ul>
<li>How often? Depends on the project…</li>
<li><strong>Warning</strong>: GitHub Actions disables <code>cron</code> CI jobs if there is no action on the repository, which makes the mechanism less useful</li>
</ul>
</section><section>
<h2 id="additional-checks-and-reportings">Additional checks and reportings</h2>
<p>There exist a number of recommended services that provide additional QA and reports.</p>
<p>Non exhaustive list:</p>
<ul>
<li><a href="https://codecov.io/">Codecov.io</a>
<ul>
<li>Code coverage</li>
<li>Supports Jacoco XML reports</li>
<li>Nice data reporting system</li>
</ul>
</li>
<li><a href="https://sonarcloud.io/">Sonarcloud</a>
<ul>
<li>Multiple measures, covering reliability, security, maintainability, duplication, complexity…</li>
</ul>
</li>
<li><a href="https://www.codacy.com/">Codacy</a>
<ul>
<li>Automated software QA for several languages</li>
</ul>
</li>
<li><a href="https://www.codefactor.io/">Code Factor</a>
<ul>
<li>Automated software QA</li>
</ul>
</li>
</ul>
</section><section>
<h2 id="high-quality-floss-checklist">High quality FLOSS checklist</h2>
<p>The <a href="https://www.linuxfoundation.org/">Linux Foundation</a> <a href="https://www.coreinfrastructure.org/">Core Infrastructure Initiative</a> created a checklist for high quality FLOSS.</p>
<p><strong><a href="https://bestpractices.coreinfrastructure.org/en">CII Best Practices Badge Program https://bestpractices.coreinfrastructure.org/en</a></strong></p>
<ul>
<li><em>Self-certification</em>: no need for bureaucracy</li>
<li>Provides a nice <em>TODO list</em> for a high quality product</li>
<li>Releases a <em>badge</em> that can be added e.g. to the project homepage</li>
</ul>
</section><section>
<h2 id="automated-evolution">Automated evolution</h2>
<p>A full-fledged CI system allows reasonably safe <em>automated evolution of software</em>
<br>
At least, in terms of <em>dependency updates</em></p>
<p>Assuming that you can <em>effectively intercept issues</em>,
here is a possible workflow for <strong>automatic</strong> dependency updates:</p>
<ol>
<li><em>Check</em> if there are new updates</li>
<li><em>Apply</em> the update in a new branch</li>
<li><em>Open</em> a pull request</li>
<li><em>Verify</em> if changes break anything
<ul>
<li>If they do, manual intervention is required</li>
</ul>
</li>
<li><em>Merge</em></li>
</ol>
</section><section>
<h2 id="automated-evolution-1">Automated evolution</h2>
<p><strong>Bots</strong> performing the aforementioned process for a variety of build systems exist.</p>
<p>They are usually integrated with the repository hosting provider</p>
<ul>
<li>Whitesource Renovate (Multiple)
<ul>
<li>Also updates github actions and Gradle Catalogs</li>
</ul>
</li>
<li>Dependabot (Multiple)</li>
<li>Gemnasium (Ruby)</li>
<li>Greenkeeper (NPM)</li>
</ul>
</section><section>
<h1 id="containers">Containers</h1>



  


<figure>
  <img src="https://g.gravizo.com/svg?%0adigraph%20structs%20%7b%0arankdir%3dLR%0agraph%20%5bfontname%3d%22helvetica%22%2c%20layout%3dneato%5d%0aedge%20%5bfontname%3d%22helvetica%22%5d%0anode%20%5bfontname%3d%22helvetica%22%2c%20shape%3drecord%2c%20style%3d%22rounded%2c%20filled%22%2c%20fontcolor%3dwhite%2c%20fixedsize%3dtrue%2c%20width%3d3%5d%3b%0a%22Bare%20metal%22%20%5bshape%3dplaintext%2c%20style%3d%22%22%2c%20fontcolor%3dblack%20fontsize%3d20%2c%20pos%3d%220%2c0%21%22%2c%20layout%3dneato%5d%0aPhysical%20%5bfillcolor%3dblack%2c%20pos%3d%220%2c0.5%21%22%5d%0a%22Operating%20System%22%20%5bfillcolor%3dgray%2c%20pos%3d%220%2c1.1%21%22%5d%0aRuntime%20%5bfillcolor%3dgreen%2c%20pos%3d%220%2c1.7%21%22%5d%0aApp1%20%5bfillcolor%3dred%2c%20width%3d0.95%2c%20pos%3d%22-1.025%2c2.3%21%22%5d%0aApp2%20%5bfillcolor%3dred%2c%20width%3d0.95%2c%20pos%3d%220%2c2.3%21%22%5d%0aApp3%20%5bfillcolor%3dred%2c%20width%3d0.95%2c%20pos%3d%221.025%2c2.3%21%22%5d%0a%22Virtual%20Machine%22%20%5bshape%3dplaintext%2c%20style%3d%22%22%2c%20fontcolor%3dblack%20fontsize%3d20%2c%20pos%3d%223.5%2c0%21%22%5d%0aVM_Phy%20%5blabel%3dPhysical%2c%20fillcolor%3dblack%2c%20pos%3d%223.5%2c0.5%21%22%5d%0a%22Host%20Operating%20System%22%20%5bfillcolor%3dgray%2c%20pos%3d%223.5%2c1.1%21%22%5d%0aHypervisor%20%5bfillcolor%3dorange%2c%20pos%3d%223.5%2c1.7%21%22%2c%20fontcolor%3dblack%5d%0aGuestOS1%20%5bfillcolor%3dgray%2c%20width%3d0.95%2c%20pos%3d%222.475%2c2.3%21%22%5d%0aGuestOS2%20%5bfillcolor%3dgray%2c%20width%3d0.95%2c%20pos%3d%223.5%2c2.3%21%22%5d%0aGuestOS3%20%5bfillcolor%3dgray%2c%20width%3d0.95%2c%20pos%3d%224.525%2c2.3%21%22%5d%0aRuntime1%20%5bfillcolor%3dgreen%2c%20width%3d0.95%2c%20pos%3d%222.475%2c2.9%21%22%5d%0aRuntime2%20%5bfillcolor%3dgreen%2c%20width%3d0.95%2c%20pos%3d%223.5%2c2.9%21%22%5d%0aRuntime3%20%5bfillcolor%3dgreen%2c%20width%3d0.95%2c%20pos%3d%224.525%2c2.9%21%22%5d%0aVM_App1%20%5blabel%3dApp1%2c%20fillcolor%3dred%2c%20width%3d0.95%2c%20pos%3d%222.475%2c3.5%21%22%5d%0aVM_App2%20%5blabel%3dApp2%2c%20fillcolor%3dred%2c%20width%3d0.95%2c%20pos%3d%223.5%2c3.5%21%22%5d%0aVM_App3%20%5blabel%3dApp3%2c%20fillcolor%3dred%2c%20width%3d0.95%2c%20pos%3d%224.525%2c3.5%21%22%5d%0a%22Container%22%20%5bshape%3dplaintext%2c%20style%3d%22%22%2c%20fontcolor%3dblack%20fontsize%3d20%2c%20pos%3d%227%2c0%21%22%5d%0aC_Phy%20%5blabel%3dPhysical%2c%20fillcolor%3dblack%2c%20pos%3d%227%2c0.5%21%22%5d%0aC_K%20%5blabel%3d%22Operating%20System%22%2c%20fillcolor%3dgray%2c%20pos%3d%227%2c1.1%21%22%5d%0a%22Container%20Service%22%20%5bfillcolor%3dblue%2c%20pos%3d%227%2c1.7%21%22%5d%0aC_Rt1%20%5blabel%3dRuntime1%2c%20fillcolor%3dgreen%2c%20width%3d0.95%2c%20pos%3d%225.975%2c2.3%21%22%5d%0aC_Rt2%20%5blabel%3dRuntime2%2c%20fillcolor%3dgreen%2c%20width%3d0.95%2c%20pos%3d%227%2c2.3%21%22%5d%0aC_Rt3%20%5blabel%3dRuntime3%2c%20fillcolor%3dgreen%2c%20width%3d0.95%2c%20pos%3d%228.025%2c2.3%21%22%5d%0aC_App1%20%5blabel%3dApp1%2c%20fillcolor%3dred%2c%20width%3d0.95%2c%20pos%3d%225.975%2c2.9%21%22%5d%0aC_App2%20%5blabel%3dApp2%2c%20fillcolor%3dred%2c%20width%3d0.95%2c%20pos%3d%227%2c2.9%21%22%5d%0aC_App3%20%5blabel%3dApp3%2c%20fillcolor%3dred%2c%20width%3d0.95%2c%20pos%3d%228.025%2c2.9%21%22%5d%0a%7d%0a" alt="" width="100%">
    <figcaption></figcaption>
</figure>

<p>Runtime <strong>isolation</strong> without operating system <strong>replication</strong></p>
</section><section>
<h1 id="why-containers">Why containers?</h1>
<p><img src="memes/works-on-my-machine.jpeg" style="
    width: 23vw;
    
    max-width: 95vw;
    max-height: 80vh;
    object-fit: contain;
">

<img src="memes/docker-born.jpeg" style="
    width: 20.8vw;
    
    max-width: 95vw;
    max-height: 80vh;
    object-fit: contain;
">
</p>
</section><section>
<h2 id="lightweight-virtual-machines">Lightweight virtual machines?</h2>
<img src="memes/lightweight-container.jpg" style="
    
    
    max-width: 95vw;
    max-height: 80vh;
    object-fit: contain;
">

</section><section>
<h2 id="more-similar-to-well-confined-processes">More similar to well-confined processes</h2>
<img src="memes/chroot.jpeg" style="
    
    height: 60vh;
    max-width: 95vw;
    max-height: 80vh;
    object-fit: contain;
">

</section><section>
<h1 id="docker">Docker</h1>
<p>Docker is a containerization platform</p>
<p><em>Standard de-facto</em> in industry</p>
<p><strong>Base concepts</strong></p>
<ul>
<li><em>Image</em>
<ul>
<li>a <em>read-only template</em> with instructions for creating a Docker container</li>
<li>images can get built upon other images</li>
<li>images are made of a stack of <em>layers</em></li>
</ul>
</li>
<li><em>Container</em>
<ul>
<li>a <em>runnable instance</em> of an image</li>
<li>namely, a “writable layer” atop an image</li>
</ul>
</li>
<li><em>Service</em>
<ul>
<li>A software component in charge of running one or multiple containers</li>
</ul>
</li>
</ul>
</section><section>
<h1 id="docker-architecture">Docker architecture</h1>
<ul>
<li><em>Registry</em>: repository of images</li>
<li><em>Daemon</em>: service pulling images from registries and instancing containers</li>
<li><em>Client</em>: interface towards the daemon</li>
</ul>
<p><img src="architecture.svg" alt=""></p>
</section><section>
<h1 id="running-docker-containers">Running docker containers</h1>
<ol>
<li>Install docker</li>
<li>Add your user to the <code>docker</code> group</li>
<li>Enable the docker service (on most Linux distributions <code>systemctl start docker</code>)</li>
<li>Pull an image: <code>docker pull adoptopenjdk</code></li>
<li>Run a container! <code>docker run adoptopenjdk</code></li>
</ol>
<p>Every container provides a <em>default command</em>, running without options runs such default in a <em>non-interactive</em> terminal.</p>
<p>Running in interactive mode can be achieved with the <code>-i</code> option</p>
<p>Running a custom command can be achieved with writing the command after the image name</p>
<ul>
<li>e.g., <code>docker run -i adoptopenjdk bash</code></li>
<li>parameters for the custom command can follow</li>
<li>use the <code>t</code> option to run in a <em>pseudo-tty</em></li>
<li>use the <code>--rm</code> to remove the container after use</li>
</ul>
</section><section>
<h1 id="interaction-with-the-outside-world">Interaction with the outside world</h1>
<p>A docker container runs <em>in isolation</em>.</p>
<p>Environment variables, network ports, and file system folders are <strong>not</strong> shared.</p>
<p>Sharing must be explicit and requires options to be specified</p>
<ul>
<li>Passing environment variables: <code>-e &lt;name&gt;=&lt;value&gt;</code></li>
<li>Mounting volumes: <code>-v &lt;host&gt;:&lt;guest&gt;:&lt;options&gt;</code>
<ul>
<li><code>&lt;host&gt;</code> is the path on the host system</li>
<li><code>&lt;guest&gt;</code> is the location where it will be mounted on the guest</li>
<li><code>&lt;options&gt;</code> can be optionally specified as mount options (e.g., <code>rw</code>, <code>ro</code>)</li>
</ul>
</li>
<li>Publishing ports: <code>-p &lt;host&gt;:&lt;guest&gt;</code>
<ul>
<li><code>&lt;host&gt;</code> is the port on the host system</li>
<li><code>&lt;guest&gt;</code> is the corresponding port on the container</li>
</ul>
</li>
</ul>
</section><section>
<h1 id="managing-images">Managing images</h1>
<p>Every image has a unique <strong>ID</strong>, and may have an associated <strong>tag</strong></p>
<p>The subcommand <code>images</code> lists the pulled images and their associated information</p>
<p>The subcommand <code>image</code> allows for running maintenance tasks, e.g.</p>
<ul>
<li><code>docker image ls</code> – same as <code>docker images</code></li>
<li><code>docker image prune</code> – removes unused images</li>
<li><code>docker image rm</code> – removes images by name</li>
<li><code>docker image tag</code> – associates a tag to an image</li>
</ul>
</section><section>
<h1 id="creating-docker-images">Creating docker images</h1>
<p>Docker images are written in a <em>Dockerfile</em></p>
<p>Every command inside a Dockerfile generates a new <em>layer</em></p>
<p>The final stack of layers creates the final <em>image</em></p>
<p>The <code>docker build</code> command interprets the Dockerfile commands to produce a sequence of layers</p>
<p>Changes to a layer do not invalidate previous layers</p>
</section><section>
<h1 id="dockerfile-syntax">Dockerfile syntax</h1>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Pulls an image from docker hub with this name. Alternatively, "scratch" can be used for an empty container</span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#204a87;font-weight:bold">FROM</span><span style="color:#4e9a06"> manjarolinux/base </span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#8f5902;font-style:italic"># Runs a command</span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#204a87;font-weight:bold">RUN</span> pacman -Sy --noconfirm gnupg archlinux-keyring manjaro-keyring<span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#8f5902;font-style:italic"># Copies a file from the local folder into the image</span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#204a87;font-weight:bold">COPY</span> makepkg.conf /etc/makepkg.conf<span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#8f5902;font-style:italic"># Adds a new environment variable</span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#204a87;font-weight:bold">ENV</span> <span style="color:#000">GEM_HOME</span><span style="color:#ce5c00;font-weight:bold">=</span>/rubygems/bin<span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#8f5902;font-style:italic"># Configures the default command to execute</span><span style="color:#a40000">
</span></span></span><span style="display:flex;"><span><span style="color:#a40000"></span><span style="color:#204a87;font-weight:bold">CMD</span> bash<span style="color:#a40000">
</span></span></span></code></pre></div></section><section>
<h1 id="naming-images">Naming images</h1>
<p>Image naming is done via <em>tags</em></p>
<p>The easiest way to do so is assigning tags at <em>build time</em> with the <code>-t</code> options of <code>docker build</code></p>
<p>The option can be repeated multiple times to make multiple tags</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="nohighlight" data-noescape=""><span style="display:flex;"><span>docker build -t <span style="color:#4e9a06">"myImage:latest"</span> -t <span style="color:#4e9a06">"myImage:0.1.0"</span>
</span></span></code></pre></div><p><code>latest</code> is usually used to identify the most recent version of some image</p>
</section><section>
<h1 id="publishing-docker-images">Publishing docker images</h1>
<p>Images get published in <em>registries</em></p>
<p>The most famous, free for publicly available images, is <em>Docker Hub</em></p>
<p>By default, Docker uses Docker Hub as registry (both for <code>pull</code> and <code>push</code> operations)</p>
<p>Docker Hub requires registration and CLI login:</p>
<ul>
<li><code>docker login docker.io</code></li>
</ul>
<p>Once done, publication is performed via <code>push</code>:</p>
<ul>
<li><code>docker push &lt;image name&gt;</code></li>
</ul>
</section><section>
<h1 id="building-docker-images-in-ci">Building docker images in CI</h1>
<p>Of course, as any other software, <em>custom docker images should get built in CI</em></p>
<p>Several integrators use containers as build environments: it is possible to <em>build a container using a container</em></p>
<p>More in general, there is <em>no inherent limit to nesting containers</em></p>
</section><section>
<h1 id="exercise">Exercise</h1>
<ul>
<li>Pick the python testing repository that we used in the previous lab:
<ul>
<li><a href="https://github.com/DanySK/python-testing-101/">https://github.com/DanySK/python-testing-101/</a></li>
</ul>
</li>
<li><strong>fork</strong> it (if you have not already)</li>
<li>Clone your fork locally</li>
<li>Make sure that you enabled actions by looking at the “Actions” tab on your GitHub repository fork</li>
</ul>
<h3 id="then">Then:</h3>
<ol>
<li>Configure a minimal test CI: at each <code>push</code>, it must print <code>Hello, World</code></li>
<li>Improve: create a two-lines script that</li>
<li>Changes directory to <code>example-py-unittest</code></li>
<li>Runs the tests
(if you do not recall the command, it is in <a href="../build/">the slides about build systems</a>)</li>
<li>Improve further: before running tests, install Python 3.10.2 using <a href="https://github.com/actions/setup-python">this action</a></li>
</ol>
<br>
<ul>
<li>You may start from <a href="https://github.com/DanySK/Tutorial-GitHub-Actions-Minimal/blob/master/.github/workflows/workflow-example.yml">this base example</a></li>
</ul>
</section>

  


</div>
      

    </div>
<script type="text/javascript" src="/course-slides/reveal-hugo/object-assign.js"></script>

<a href="/course-slides/reveal-js/dist/print/" id="print-location" style="display: none;"></a>

<script type="application/json" id="reveal-hugo-site-params">{"custom_theme":"custom-theme.scss","custom_theme_compile":true,"custom_theme_options":{"enablesourcemap":true,"targetpath":"css/custom-theme.css"},"height":"1080","highlight_theme":"github","history":true,"mermaid":[{"gitGraph":{"mainBranchName":"master","rotateCommitLabel":true},"startOnLoad":false,"useMaxWidth":false}],"slide_number":true,"theme":"league","transition":"slide","transition_speed":"fast","width":"1920"}</script>
<script type="application/json" id="reveal-hugo-page-params">null</script>

<script src="/course-slides/reveal-js/dist/reveal.js"></script>


  
  
  <script type="text/javascript" src="/course-slides/reveal-js/plugin/markdown/markdown.js"></script>
  
  <script type="text/javascript" src="/course-slides/reveal-js/plugin/highlight/highlight.js"></script>
  
  <script type="text/javascript" src="/course-slides/reveal-js/plugin/zoom/zoom.js"></script>
  
  <script type="text/javascript" src="/course-slides/reveal-js/plugin/notes/notes.js"></script>
  
  
  <script type="text/javascript" src="/course-slides/reveal-js/plugin/notes/notes.js"></script>




<script type="text/javascript">
  
  
  function camelize(map) {
    if (map) {
      Object.keys(map).forEach(function(k) {
        newK = k.replace(/(\_\w)/g, function(m) { return m[1].toUpperCase() });
        if (newK != k) {
          map[newK] = map[k];
          delete map[k];
        }
      });
    }
    return map;
  }

  var revealHugoDefaults = { center: true, controls: true, history: true, progress: true, transition: "slide" };

  var revealHugoPlugins = { 
    plugins: [ RevealMarkdown, RevealHighlight, RevealNotes, RevealZoom ]
   };
  var revealHugoSiteParams = JSON.parse(document.getElementById('reveal-hugo-site-params').innerHTML);
  var revealHugoPageParams = JSON.parse(document.getElementById('reveal-hugo-page-params').innerHTML);
  
  var options = Object.assign({},
    camelize(revealHugoDefaults),
    camelize(revealHugoSiteParams),
    camelize(revealHugoPageParams),
    camelize(revealHugoPlugins));
  Reveal.initialize(options);
</script>






  

  

  

  

  

  
    
  

  

  



  <script src="https://cdn.jsdelivr.net/npm/mermaid@9.1.6/dist/mermaid.min.js"></script>
  <script>
    mermaid.initialize({"gitGraph":{"mainBranchName":"master","rotateCommitLabel":true},"startOnLoad":false,"useMaxWidth":false});

    let render = (event) => {
      let mermaidElems = event.currentSlide.querySelectorAll('.mermaid');
      if (!mermaidElems.length){
          return
      }
      mermaidElems.forEach(mermaidElem => {
          let processed = mermaidElem.getAttribute('data-processed');
          if (!processed){
              
              mermaid.init(undefined, mermaidElem);
          }
      });
    };
    
    render({currentSlide: Reveal.getCurrentSlide()});

    Reveal.on('slidechanged', render);
    Reveal.on('ready', render);
  </script>

    <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      },
      svg: {
        fontCache: 'global'
      }
    };
</script>

<script type="text/javascript" id="MathJax-script" async="" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>

<script>
  if (/.*?(\?|&)print-pdf/.test(window.location.toString())) {
      var ytVideos = document.getElementsByTagName("iframe")
      for (let i = 0; i < ytVideos.length; i++) {
          var videoFrame = ytVideos[i]
          var isYouTube = /^https?:\/\/(www.)youtube\.com\/.*/.test(videoFrame.src)
          if (isYouTube) {
              console.log(`Removing ${videoFrame.src}`)
              var parent = videoFrame.parentElement
              videoFrame.remove()
              var p = document.createElement('p')
              p.append(
                  document.createTextNode(
                      "There was an embedded video here, but it is disabled in the printed version of the slides."
                  )
              )
              p.append(document.createElement('br'))
              p.append(
                  document.createTextNode(
                      `Visit instead ${
                          videoFrame.src
                      } or ${
                          videoFrame.src.replace(
                              /(^https?:\/\/(www.)youtube\.com)\/(embed\/)(\w+).*/,
                              "https://www.youtube.com/watch?v=$4"
                          )
                      }`
                  )
              )
              parent.appendChild(p)
          }
      }
  }
</script>


    
  

</body></html>